% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/prep-lf.R
\name{prep_lf_data}
\alias{prep_lf_data}
\title{Prepare length composition data for model input}
\usage{
prep_lf_data(
  data,
  lf_wide,
  lf_keep_fisheries = NULL,
  lf_switch = 1L,
  lf_minbin = NULL,
  lf_maxbin = NULL
)
}
\arguments{
\item{data}{a \code{list} containing at minimum the length structure scalars
\code{len_bin_start}, \code{len_bin_width}, \code{n_len}, and
\code{n_fishery}.}

\item{lf_wide}{a \code{data.frame} in wide format: columns \code{fishery},
\code{year}, \code{month}, \code{ts} plus one numeric column per length
bin (named by the bin lower-bound value).  Typically produced by
\code{tidyr::pivot_wider()} on the long-format \code{wcpo_bet_lf} object.}

\item{lf_keep_fisheries}{integer vector of fishery indices to retain.  Pass
\code{NULL} (the default) to keep all fisheries present in \code{lf_wide}.}

\item{lf_switch}{integer likelihood type selector passed straight through to
\code{data$lf_switch} (1 = multinomial, 2 = Dirichlet, 3
= Dirichlet-multinomial).  Default \code{1L}.}

\item{lf_minbin}{integer vector length \code{n_fishery} giving the minimum
bin index (1-based) used for each fishery.  Defaults to
\code{rep(1L, n_fishery)}.}

\item{lf_maxbin}{integer vector length \code{n_fishery} giving the maximum
bin index (1-based) used for each fishery.  Defaults to
\code{rep(n_len, n_fishery)}.}
}
\value{
The input \code{data} list with the following elements appended or
updated:
\describe{
\item{\code{len_lower}, \code{len_upper}, \code{len_mid}}{Length bin
boundary and midpoint vectors derived from the scalar inputs.}
\item{\code{lf_switch}}{Passed through from the argument.}
\item{\code{lf_obs_in}}{Matrix of observed proportions,
\code{[n_obs x n_len]}.}
\item{\code{lf_n}}{Numeric vector of sample sizes per observation row.}
\item{\code{lf_fishery}}{Integer vector of fishery index per observation
row.}
\item{\code{lf_fishery_f}}{Integer vector of unique fishery indices with
LF data.}
\item{\code{lf_n_f}}{Integer vector of observation counts per fishery.}
\item{\code{lf_year}}{Integer vector of model timestep index (1-based)
per observation row.}
\item{\code{lf_season}}{Integer vector of season index (all 1).}
\item{\code{lf_minbin}, \code{lf_maxbin}}{Passed through from arguments.}
\item{\code{removal_switch_f}}{Integer vector \code{[n_fishery]} of
removal flags (all 0).}
\item{\code{n_lf}}{Total number of observation rows.}
\item{\code{lf_obs_data}}{Named list \code{list(obs = lf_obs_list)} for
plain-R access in \code{get_length_like}.}
\item{\code{lf_obs_flat}}{Flattened numeric vector of counts (for
multinomial, \code{lf_switch = 1}).}
\item{\code{lf_obs_ints}}{Flattened integer vector of rounded counts
(for Dirichlet-multinomial, \code{lf_switch = 3}).}
\item{\code{lf_obs_prop}}{Flattened numeric vector of normalised
proportions (for Dirichlet, \code{lf_switch = 2}).}
\item{\code{lf_nbins}}{Number of bins used in each observation (scalar,
derived from the first fishery's min/max bin setting).}
}
}
\description{
Transforms a pivoted wide-format length-frequency data frame (one row per fishery
x timestep, bins as columns) into the set of model-ready arrays and vectors
that \code{opal_model} and \code{get_length_like} expect.  The function
validates bin alignment against the length structure in \code{data}, optionally
filters to a subset of fisheries, and appends every derived object directly to
\code{data}.
}
\details{
Rows in \code{lf_wide} with a total sample size of zero are silently
removed before any other processing.  Bin alignment between the data frame
columns and the model's length structure is checked with
\code{stopifnot()}.
}
\seealso{
\code{\link{get_length_like}}, \code{\link{opal_model}}
}
