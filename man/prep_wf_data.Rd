% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/prep-wf.R
\name{prep_wf_data}
\alias{prep_wf_data}
\title{Prepare weight composition data for model input}
\usage{
prep_wf_data(
  data,
  wf_wide,
  wf_keep_fisheries = NULL,
  wf_switch = 1L,
  wf_minbin = NULL,
  wf_maxbin = NULL,
  wf_var_adjust = NULL
)
}
\arguments{
\item{data}{list containing at minimum: lw_a, lw_b, len_bin_start,
len_bin_width, n_len, n_fishery, and the weight bin scalars
wt_bin_start, wt_bin_width, n_wt.}

\item{wf_wide}{data.frame in wide format: columns fishery, year, month,
ts plus one numeric column per weight bin (named by bin value).}

\item{wf_keep_fisheries}{integer vector of fishery indices to retain
(NULL = keep all).}

\item{wf_switch}{integer likelihood type (1=multinomial, 2=Dirichlet,
3=Dirichlet-multinomial). Default 1L.}

\item{wf_minbin}{integer vector (length n_fishery) min weight bin index.
Defaults to rep(1L, n_fishery).}

\item{wf_maxbin}{integer vector (length n_fishery) max weight bin index.
Defaults to rep(n_wt, n_fishery).}

\item{wf_var_adjust}{numeric vector (length n_fishery) variance adjustment
divisors. Defaults to rep(1, n_fishery).}
}
\value{
data list with the following weight composition elements appended:
\describe{
\item{\code{wf_switch}}{Passed through from the argument.}
\item{\code{wt_lower}, \code{wt_upper}, \code{wt_mid}}{Weight bin
boundary and midpoint vectors derived from the scalar inputs.}
\item{\code{wt_bin_edges}}{Weight bin boundary vector (length n_wt + 1).}
\item{\code{wf_rebin_matrix}}{Precomputed rebinning matrix (n_wt x n_len)
for converting predicted length compositions to weight compositions.}
\item{\code{n_wf}}{Total number of WF observation rows.}
\item{\code{wf_obs_in}}{Matrix of observed proportions (n_wf x n_wt).}
\item{\code{wf_obs_flat}}{Flattened numeric vector of counts (for
multinomial, \code{wf_switch = 1}).}
\item{\code{wf_obs_ints}}{Flattened integer vector of rounded counts
(for Dirichlet-multinomial, \code{wf_switch = 3}).}
\item{\code{wf_obs_prop}}{Flattened numeric vector of normalised
proportions (for Dirichlet, \code{wf_switch = 2}).}
\item{\code{wf_n}}{Numeric vector of sample sizes per observation row.}
\item{\code{wf_fishery}}{Integer vector of fishery index per observation
row.}
\item{\code{wf_fishery_f}}{Integer vector of unique fishery indices with
WF data.}
\item{\code{wf_n_f}}{Integer vector of observation counts per fishery.}
\item{\code{wf_year}}{Integer vector of model timestep per observation
row.}
\item{\code{wf_minbin}, \code{wf_maxbin}}{Passed through from arguments.}
\item{\code{wf_var_adjust}}{Passed through from argument; numeric vector
\code{[n_fishery]} of variance-adjustment divisors applied to
\code{wf_n}.}
}
}
\description{
Transforms a pivoted wide-format weight-frequency data frame into
model-ready arrays and vectors that get_weight_like() expects.
Also precomputes the rebinning matrix for converting predicted
length compositions to weight compositions.
}
\seealso{
\code{\link{prep_lf_data}}, \code{\link{opal_model}}
}
