<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The BET model • opal</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Montserrat-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The BET model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">opal</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bet.html">The BET model</a></li>
    <li><a class="dropdown-item" href="../articles/quickstart.html">Quickstart Guide</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/N-DucharmeBarth-NOAA/opal" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/N-DucharmeBarth-NOAA/opal/issues" aria-label="Report an issue"><span class="fa fas fa-bug"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>The BET model</h1>
            
      

      <div class="d-none name"><code>bet.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>opal</code> package is an R package that contains example
fisheries data from western and central pacific bigeye tuna (BET). This
page provides examples using the <code>opal</code> BET model.</p>
</div>
<div class="section level2">
<h2 id="load-inputs">Load inputs<a class="anchor" aria-label="anchor" href="#load-inputs"></a>
</h2>
<p>Load the <code>opal</code> package and the <code>RTMB</code>
dependency. The <code>ggplot2</code> package is used for plotting.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://n-ducharmebarth-noaa.github.io/opal/">opal</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kaskr/RTMB" class="external-link">RTMB</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The bundled data object <code>wcpo_bet_data</code> contains all
biological parameters, catch and CPUE observations, length structure,
and prior specifications needed for the BET assessment model:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">wcpo_bet_data</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">wcpo_bet_data</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "age_a"          "n_age"          "n_season"       "n_fishery"     </span></span>
<span><span class="co">#&gt;  [5] "len_bin_start"  "len_bin_width"  "n_len"          "first_yr"      </span></span>
<span><span class="co">#&gt;  [9] "last_yr"        "years"          "n_year"         "first_yr_catch"</span></span>
<span><span class="co">#&gt; [13] "catch_units_f"  "cpue_switch"    "cpue_data"      "A1"            </span></span>
<span><span class="co">#&gt; [17] "A2"             "lw_a"           "lw_b"           "maturity"      </span></span>
<span><span class="co">#&gt; [21] "fecundity"      "M"              "catch_obs_ysf"  "sel_type_f"    </span></span>
<span><span class="co">#&gt; [25] "priors"</span></span></code></pre></div>
<p>Key dimensions of the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of ages:"</span>, <span class="va">data</span><span class="op">$</span><span class="va">n_age</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of ages: 40</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of years:"</span>, <span class="va">data</span><span class="op">$</span><span class="va">n_year</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of years: 268</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of fisheries:"</span>, <span class="va">data</span><span class="op">$</span><span class="va">n_fishery</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of fisheries: 15</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of length bins:"</span>, <span class="va">data</span><span class="op">$</span><span class="va">n_len</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of length bins: 95</span></span></code></pre></div>
<div class="section level3">
<h3 id="biological-inputs">Biological inputs<a class="anchor" aria-label="anchor" href="#biological-inputs"></a>
</h3>
<p>Natural mortality at age, maturity at length, and length-weight
parameters are all contained in the data object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ages</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">age_a</span></span>
<span><span class="va">real_age</span> <span class="op">&lt;-</span> <span class="va">ages</span> <span class="op">/</span> <span class="fl">4</span></span>
<span></span>
<span><span class="co"># Natural mortality</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>age <span class="op">=</span> <span class="va">real_age</span>, M <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">M</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">M</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age (years)"</span>, y <span class="op">=</span> <span class="st">"M (quarterly rate)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Natural Mortality-at-Age"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bet_files/figure-html/plot-biology-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Maturity at length</span></span>
<span><span class="va">len_mid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">len_bin_start</span> <span class="op">+</span> <span class="va">data</span><span class="op">$</span><span class="va">len_bin_width</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>               by <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">len_bin_width</span>, length.out <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">n_len</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>length <span class="op">=</span> <span class="va">len_mid</span>, maturity <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">maturity</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span>, y <span class="op">=</span> <span class="va">maturity</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Length (cm)"</span>, y <span class="op">=</span> <span class="st">"Maturity"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Maturity-at-Length"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bet_files/figure-html/plot-biology-2.png" class="r-plt" alt="" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="model-setup">Model setup<a class="anchor" aria-label="anchor" href="#model-setup"></a>
</h2>
<div class="section level3">
<h3 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h3>
<p>Define the initial parameter values. Growth parameters
(<code>log_L1</code>, <code>log_L2</code>, <code>log_k</code>,
<code>log_CV1</code>, <code>log_CV2</code>) and selectivity
(<code>par_sel</code>) are initialised at reasonable starting values.
Load these from the bundled <code>wcpo_bet_parameters</code> data
object:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">)</span></span>
<span></span>
<span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  log_B0 <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  log_h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_h</span><span class="op">)</span>,</span>
<span>  log_sigma_r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_sigma_r</span><span class="op">)</span>,</span>
<span>  log_cpue_q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_cpue_q</span><span class="op">)</span>,</span>
<span>  cpue_creep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">cpue_creep</span><span class="op">)</span>,</span>
<span>  log_cpue_tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  log_cpue_omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_cpue_omega</span><span class="op">)</span>,</span>
<span>  log_L1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_L1</span><span class="op">)</span>,</span>
<span>  log_L2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_L2</span><span class="op">)</span>,</span>
<span>  log_k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_k</span><span class="op">)</span>,</span>
<span>  log_CV1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_CV1</span><span class="op">)</span>,</span>
<span>  log_CV2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_CV2</span><span class="op">)</span>,</span>
<span>  par_sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">par_sel</span><span class="op">)</span>,</span>
<span>  rdev_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">rdev_y</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h3>
<p>Priors are specified using <code><a href="../reference/get_priors.html">get_priors()</a></code>. The data object
already contains prior center values for growth parameters:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span><span class="op">$</span><span class="va">priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_priors.html">get_priors</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">parameters</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/evaluate_priors.html">evaluate_priors</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">parameters</span>, priors <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">priors</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 92393.12</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parameter-map">Parameter map<a class="anchor" aria-label="anchor" href="#parameter-map"></a>
</h3>
<p>Use RTMB’s <code>map</code> option to turn parameters on/off.
Parameters mapped to <code>factor(NA)</code> are fixed at their initial
values:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">$</span><span class="va">par_sel</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">$</span><span class="va">par_sel</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">map_rdev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">$</span><span class="va">rdev_y</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># log_B0 = factor(NA),</span></span>
<span>  log_h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  log_sigma_r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  <span class="co"># log_cpue_q = factor(NA),</span></span>
<span>  cpue_creep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  log_cpue_tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  log_cpue_omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  <span class="co"># rdev_y = as.factor(map_rdev),</span></span>
<span>  par_sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">map_sel</span><span class="op">)</span>,</span>
<span>  log_L1  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  log_L2  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  log_k   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  log_CV1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  log_CV2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="build-the-ad-object">Build the AD object<a class="anchor" aria-label="anchor" href="#build-the-ad-object"></a>
</h3>
<p>Using the <code>data</code>, the <code>parameters</code>, the
parameter <code>map</code>, and the model (<code>opal_model</code>), the
AD object is created using RTMB’s <code>MakeADFun</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu">MakeADFun</span><span class="op">(</span>func <span class="op">=</span> <span class="fu"><a href="../reference/cmb.html">cmb</a></span><span class="op">(</span><span class="va">opal_model</span>, <span class="va">data</span><span class="op">)</span>, parameters <span class="op">=</span> <span class="va">parameters</span>, map <span class="op">=</span> <span class="va">map</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "log_B0"     "log_cpue_q" "rdev_y"</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">fn</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 584.7051</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">gr</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; outer mgc:  665.2478</span></span>
<span><span class="co">#&gt;          [,1]     [,2]      [,3]      [,4]     [,5]      [,6]      [,7]</span></span>
<span><span class="co">#&gt; [1,] 1.065922 665.2478 -11.68096 -14.26557 -9.81417 -9.900868 -18.71891</span></span>
<span><span class="co">#&gt;           [,8]      [,9]     [,10]    [,11]     [,12]     [,13]     [,14]</span></span>
<span><span class="co">#&gt; [1,] -13.77988 -14.17164 -17.70791 -16.9681 -8.044774 -8.034375 -26.97926</span></span>
<span><span class="co">#&gt;          [,15]     [,16]     [,17]     [,18]     [,19]     [,20]     [,21]</span></span>
<span><span class="co">#&gt; [1,] -11.25757 -19.30693 -17.35314 -10.87147 -6.712221 -15.98444 -20.82175</span></span>
<span><span class="co">#&gt;          [,22]     [,23]     [,24]     [,25]     [,26]     [,27]    [,28]</span></span>
<span><span class="co">#&gt; [1,] -9.324704 -13.85078 -11.57353 -9.001889 -6.908133 -7.295254 -9.13823</span></span>
<span><span class="co">#&gt;          [,29]     [,30]     [,31]    [,32]     [,33]    [,34]     [,35]</span></span>
<span><span class="co">#&gt; [1,] -11.06084 -14.21884 -8.488221 -9.58546 -10.41193 -12.4764 -6.413628</span></span>
<span><span class="co">#&gt;          [,36]     [,37]     [,38]     [,39]     [,40]   [,41]     [,42]</span></span>
<span><span class="co">#&gt; [1,] -14.54504 -9.898263 -7.958596 -10.75903 -9.054115 -20.837 -8.206194</span></span>
<span><span class="co">#&gt;          [,43]     [,44]     [,45]     [,46]     [,47]     [,48]     [,49]</span></span>
<span><span class="co">#&gt; [1,] -7.912243 -10.42431 -16.06861 -7.699976 -6.801717 -8.802698 -7.197453</span></span>
<span><span class="co">#&gt;          [,50]     [,51]     [,52]     [,53]    [,54]     [,55]     [,56]</span></span>
<span><span class="co">#&gt; [1,] -7.915582 -7.489077 -10.26043 -6.903141 -7.89138 -15.25283 -5.352987</span></span>
<span><span class="co">#&gt;          [,57]     [,58]     [,59]     [,60]     [,61]     [,62]     [,63]</span></span>
<span><span class="co">#&gt; [1,] -5.567669 -6.362258 -4.749596 -4.471054 -4.594404 -3.931069 -8.938181</span></span>
<span><span class="co">#&gt;          [,64]     [,65]     [,66]     [,67]     [,68]     [,69]     [,70]</span></span>
<span><span class="co">#&gt; [1,] -3.611164 -3.232485 -3.336969 -4.525529 -2.453666 -2.192784 -2.178357</span></span>
<span><span class="co">#&gt;          [,71]     [,72]     [,73]     [,74]     [,75]     [,76]     [,77]</span></span>
<span><span class="co">#&gt; [1,] -2.645582 -2.072859 -2.193959 -2.041077 -2.126055 -3.110924 -1.593746</span></span>
<span><span class="co">#&gt;          [,78]     [,79]      [,80]     [,81]      [,82]     [,83]     [,84]</span></span>
<span><span class="co">#&gt; [1,] -1.445331 -1.125861 -0.7254851 -2.872688 -0.3907576 -3.413878 -1.394002</span></span>
<span><span class="co">#&gt;          [,85]     [,86]     [,87]     [,88]     [,89]     [,90]     [,91]</span></span>
<span><span class="co">#&gt; [1,] -1.648394 -2.018129 -2.494717 -2.839109 -3.505909 -3.459283 -3.212223</span></span>
<span><span class="co">#&gt;          [,92]     [,93]     [,94]     [,95]     [,96]     [,97]     [,98]</span></span>
<span><span class="co">#&gt; [1,] -3.050008 -3.096186 -2.748742 -2.427447 -2.189574 -2.000979 -2.113387</span></span>
<span><span class="co">#&gt;          [,99]    [,100]    [,101]   [,102]   [,103]    [,104]   [,105]</span></span>
<span><span class="co">#&gt; [1,] -1.652702 0.3145913 0.8716859 3.946002 3.114384 -1.533977 3.269662</span></span>
<span><span class="co">#&gt;         [,106]    [,107]    [,108]   [,109]   [,110]   [,111]   [,112]</span></span>
<span><span class="co">#&gt; [1,] 0.6328272 0.8256297 -2.099231 1.608665 1.026931 2.566182 2.792205</span></span>
<span><span class="co">#&gt;         [,113]   [,114]   [,115]   [,116]   [,117]   [,118]   [,119]   [,120]</span></span>
<span><span class="co">#&gt; [1,] -0.822488 8.302374 3.491446 6.548473 8.105699 2.206211 3.548908 8.747349</span></span>
<span><span class="co">#&gt;        [,121]   [,122]   [,123]   [,124]     [,125]    [,126]   [,127]   [,128]</span></span>
<span><span class="co">#&gt; [1,] 4.971096 4.273207 16.45161 0.928629 -0.3643806 0.3071737 8.733235 11.31333</span></span>
<span><span class="co">#&gt;        [,129] [,130]     [,131]    [,132]   [,133]   [,134]   [,135]   [,136]</span></span>
<span><span class="co">#&gt; [1,] 4.086772 15.309 -0.9101051 0.6788307 2.387828 2.658945 2.135988 1.507292</span></span>
<span><span class="co">#&gt;        [,137]   [,138]     [,139]    [,140]   [,141]   [,142]   [,143]   [,144]</span></span>
<span><span class="co">#&gt; [1,] 7.580945 1.414192 -0.8449018 -2.075111 13.81066 2.384396 1.538312 4.934111</span></span>
<span><span class="co">#&gt;         [,145]   [,146]   [,147]   [,148]   [,149]   [,150]      [,151]</span></span>
<span><span class="co">#&gt; [1,] 0.8910841 1.821192 2.144028 5.473371 1.353118 1.028252 -0.06050599</span></span>
<span><span class="co">#&gt;        [,152]  [,153]   [,154]   [,155]   [,156] [,157]   [,158]   [,159]</span></span>
<span><span class="co">#&gt; [1,] 6.267656 2.32815 7.820962 3.392073 4.048114 2.6852 4.448881 6.534874</span></span>
<span><span class="co">#&gt;        [,160]   [,161]   [,162]   [,163]   [,164] [,165]   [,166]  [,167]</span></span>
<span><span class="co">#&gt; [1,] 3.271622 3.411703 1.261352 3.297143 2.022279 2.2163 0.114358 1.69346</span></span>
<span><span class="co">#&gt;        [,168]    [,169]   [,170]   [,171]    [,172]   [,173]   [,174]   [,175]</span></span>
<span><span class="co">#&gt; [1,] 6.948515 -2.123725 7.206173 3.237693 0.6126806 5.004738 4.098924 3.743549</span></span>
<span><span class="co">#&gt;        [,176]   [,177]   [,178]   [,179]   [,180]      [,181]   [,182]   [,183]</span></span>
<span><span class="co">#&gt; [1,] 3.604363 4.213614 3.422573 2.967526 1.278868 -0.03973641 17.22478 5.976636</span></span>
<span><span class="co">#&gt;        [,184]  [,185]   [,186]   [,187]   [,188]   [,189]   [,190]   [,191]</span></span>
<span><span class="co">#&gt; [1,] 9.444755 8.70074 1.173024 20.68735 10.47452 4.661198 4.416462 10.11543</span></span>
<span><span class="co">#&gt;         [,192]   [,193]    [,194]   [,195]  [,196]   [,197]   [,198]   [,199]</span></span>
<span><span class="co">#&gt; [1,] 0.3972701 7.527196 -1.368914 4.389852 2.39165 2.006611 5.430926 3.333966</span></span>
<span><span class="co">#&gt;        [,200]   [,201]   [,202]   [,203]   [,204]   [,205]  [,206]   [,207]</span></span>
<span><span class="co">#&gt; [1,] 9.744511 9.663859 16.08717 12.32187 10.20443 11.66942 3.55409 5.807566</span></span>
<span><span class="co">#&gt;        [,208]    [,209]   [,210]   [,211]   [,212]   [,213]   [,214]   [,215]</span></span>
<span><span class="co">#&gt; [1,] 3.534067 0.1003533 6.547505 22.37802 24.74362 24.08991 9.165729 19.60319</span></span>
<span><span class="co">#&gt;        [,216]   [,217]   [,218]   [,219]   [,220]   [,221]   [,222]   [,223]</span></span>
<span><span class="co">#&gt; [1,] 4.391456 13.90066 17.70927 11.70893 11.57438 3.023483 13.01983 1.725407</span></span>
<span><span class="co">#&gt;        [,224]   [,225]   [,226]   [,227]   [,228]   [,229]   [,230]   [,231]</span></span>
<span><span class="co">#&gt; [1,] 8.635011 7.032007 8.640161 11.72414 11.10801 10.23762 15.02209 4.805921</span></span>
<span><span class="co">#&gt;        [,232]   [,233]     [,234]   [,235]   [,236]   [,237]   [,238]   [,239]</span></span>
<span><span class="co">#&gt; [1,] 10.95535 7.057241 -0.9275546 8.241586 25.21266 6.545207 7.551524 1.040936</span></span>
<span><span class="co">#&gt;       [,240]   [,241]   [,242]   [,243]   [,244]   [,245]   [,246]   [,247]</span></span>
<span><span class="co">#&gt; [1,] 4.67883 6.355778 2.957266 16.30849 7.931503 2.613837 1.372477 4.075347</span></span>
<span><span class="co">#&gt;        [,248]   [,249]  [,250]   [,251]     [,252]   [,253]   [,254]   [,255]</span></span>
<span><span class="co">#&gt; [1,] 7.254716 4.450089 4.47676 4.941414 -0.5836441 7.161057 5.044268 4.503889</span></span>
<span><span class="co">#&gt;        [,256]   [,257]   [,258]   [,259]  [,260]   [,261]   [,262]    [,263]</span></span>
<span><span class="co">#&gt; [1,] 1.712293 10.44751 2.209245 4.487058 3.84472 2.070184 4.501197 0.5909219</span></span>
<span><span class="co">#&gt;        [,264]   [,265]    [,266]     [,267]    [,268]    [,269]    [,270]</span></span>
<span><span class="co">#&gt; [1,] 1.316229 2.387588 -1.104535 -0.7036507 -2.285416 -2.101558 0.6256006</span></span></code></pre></div>
<p>Inspect initial model outputs:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">spawning_biomass_y</span>, type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time step"</span>, ylab <span class="op">=</span> <span class="st">"Spawning biomass (mt)"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Initial spawning biomass trajectory"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bet_files/figure-html/init-checks-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_catch.html">plot_catch</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, obj <span class="op">=</span> <span class="va">obj</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The maximum catch difference was: 1.10394466901198e-08"</span></span></code></pre></div>
<p><img src="bet_files/figure-html/init-checks-2.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="parameter-bounds">Parameter bounds<a class="anchor" aria-label="anchor" href="#parameter-bounds"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Lwr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Upr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Lwr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"log_B0"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Upr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"log_B0"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">22</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Lwr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"log_cpue_q"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">Upr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"log_cpue_q"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">Lwr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"rdev_y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">$</span><span class="va">rdev_y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Upr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"rdev_y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">$</span><span class="va">rdev_y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span>, lower <span class="op">=</span> <span class="va">Lwr</span>, upper <span class="op">=</span> <span class="va">Upr</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="optimisation">Optimisation<a class="anchor" aria-label="anchor" href="#optimisation"></a>
</h2>
<p>Optimise using the <code>nlminb</code> function, do it twice to be
sure to be sure (said with Irish accent):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>eval.max <span class="op">=</span> <span class="fl">10000</span>, iter.max <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></span><span class="op">(</span>start <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">par</span>, objective <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">fn</span>, gradient <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">gr</span>,</span>
<span>              hessian <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">he</span>, lower <span class="op">=</span> <span class="va">Lwr</span>, upper <span class="op">=</span> <span class="va">Upr</span>, control <span class="op">=</span> <span class="va">control</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in nlminb(start = obj$par, objective = obj$fn, gradient = obj$gr, :</span></span>
<span><span class="co">#&gt; NA/NaN function evaluation</span></span>
<span><span class="co">#&gt; Warning in nlminb(start = obj$par, objective = obj$fn, gradient = obj$gr, :</span></span>
<span><span class="co">#&gt; NA/NaN function evaluation</span></span>
<span><span class="co">#&gt; Warning in nlminb(start = obj$par, objective = obj$fn, gradient = obj$gr, :</span></span>
<span><span class="co">#&gt; NA/NaN function evaluation</span></span>
<span><span class="co">#&gt; Warning in nlminb(start = obj$par, objective = obj$fn, gradient = obj$gr, :</span></span>
<span><span class="co">#&gt; NA/NaN function evaluation</span></span>
<span><span class="co">#&gt; Warning in nlminb(start = obj$par, objective = obj$fn, gradient = obj$gr, :</span></span>
<span><span class="co">#&gt; NA/NaN function evaluation</span></span>
<span><span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></span><span class="op">(</span>start <span class="op">=</span> <span class="va">opt</span><span class="op">$</span><span class="va">par</span>, objective <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">fn</span>, gradient <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">gr</span>,</span>
<span>              hessian <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">he</span>, lower <span class="op">=</span> <span class="va">Lwr</span>, upper <span class="op">=</span> <span class="va">Upr</span>, control <span class="op">=</span> <span class="va">control</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in nlminb(start = opt$par, objective = obj$fn, gradient = obj$gr, :</span></span>
<span><span class="co">#&gt; NA/NaN function evaluation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">gr</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Compare initial and estimated parameter values:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span>, </span>
<span>           value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">env</span><span class="op">$</span><span class="fu">parList</span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">env</span><span class="op">$</span><span class="va">last.par.best</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">bounds</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;          init       value          par     lower     upper</span></span>
<span><span class="co">#&gt; 1 20.00000000 14.13456135       log_B0  0.000000 22.000000</span></span>
<span><span class="co">#&gt; 2 -0.05129329 -0.05129329        log_h        NA        NA</span></span>
<span><span class="co">#&gt; 3 -0.51082562 -0.51082562  log_sigma_r        NA        NA</span></span>
<span><span class="co">#&gt; 4  0.00000000 -0.02404871   log_cpue_q -2.302585  2.302585</span></span>
<span><span class="co">#&gt; 5  0.00000000  0.00000000   cpue_creep        NA        NA</span></span>
<span><span class="co">#&gt; 6 -2.30258509 -2.30258509 log_cpue_tau        NA        NA</span></span></code></pre></div>
<p>Inspect fitted CPUE and catch:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">cpue_data</span><span class="op">$</span><span class="va">value</span>, col <span class="op">=</span> <span class="fl">2</span>, pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time step"</span>, ylab <span class="op">=</span> <span class="st">"CPUE"</span>, main <span class="op">=</span> <span class="st">"CPUE: observed vs predicted"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">cpue_log_obs</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"gray70"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">cpue_pred</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="bet_files/figure-html/opt-catch-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">catch_pred_ysf</span> <span class="op">-</span> <span class="va">data</span><span class="op">$</span><span class="va">catch_obs_ysf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9998741</span></span>
<span><span class="fu"><a href="../reference/plot_catch.html">plot_catch</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, obj <span class="op">=</span> <span class="va">obj</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The maximum catch difference was: 2.12415216083173e-06"</span></span></code></pre></div>
<p><img src="bet_files/figure-html/opt-cpue-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_catch.html">plot_catch</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, obj <span class="op">=</span> <span class="va">obj</span>, plot_resid <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The maximum catch difference was: 2.12415216083173e-06"</span></span></code></pre></div>
<p><img src="bet_files/figure-html/opt-cpue-2.png" class="r-plt" alt="" width="672"></p>
<p>Inspect estimated spawning biomass trajectory:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">spawning_biomass_y</span>, type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time step"</span>, ylab <span class="op">=</span> <span class="st">"Spawning biomass (mt)"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Estimated spawning biomass trajectory"</span>,</span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">spawning_biomass_y</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="bet_files/figure-html/opt-spbio-1.png" class="r-plt" alt="" width="672"></p>
<div class="section level3">
<h3 id="selectivity">Selectivity<a class="anchor" aria-label="anchor" href="#selectivity"></a>
</h3>
<p>Visualise the selectivity curves by fleet:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rep</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">sel_fya</span> <span class="op">&lt;-</span> <span class="va">rep</span><span class="op">$</span><span class="va">sel_fya</span></span>
<span></span>
<span><span class="va">fleet_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F01_LL.NORTH"</span>, <span class="st">"F02_LL.US"</span>, <span class="st">"F03_LL.OFFSH"</span>,</span>
<span>                 <span class="st">"F04_LL.EQUAT"</span>, <span class="st">"F05_LL.WEST"</span>, <span class="st">"F06_LL.SOUTH"</span>, <span class="st">"F07_LL.AUS"</span>,</span>
<span>                 <span class="st">"F08_PS.ASSOC"</span>, <span class="st">"F09_PS.UNASS"</span>, <span class="st">"F10_DOM.MISC"</span>,</span>
<span>                 <span class="st">"F11_DOM.HL"</span>, <span class="st">"F12_JP.PS.N"</span>, <span class="st">"F13_JP.PL"</span>, <span class="st">"F14_EQ.PL"</span>,</span>
<span>                 <span class="st">"S01_INDEX"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sel_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>fishery <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">data</span><span class="op">$</span><span class="va">n_fishery</span>, age <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">data</span><span class="op">$</span><span class="va">n_age</span><span class="op">)</span></span>
<span><span class="va">sel_df</span><span class="op">$</span><span class="va">selectivity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sel_df</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sel_fya</span><span class="op">[</span><span class="va">sel_df</span><span class="op">$</span><span class="va">fishery</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">sel_df</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">sel_df</span><span class="op">$</span><span class="va">real_age</span> <span class="op">&lt;-</span> <span class="va">sel_df</span><span class="op">$</span><span class="va">age</span> <span class="op">/</span> <span class="fl">4</span></span>
<span><span class="va">sel_df</span><span class="op">$</span><span class="va">fleet_name</span> <span class="op">&lt;-</span> <span class="va">fleet_names</span><span class="op">[</span><span class="va">sel_df</span><span class="op">$</span><span class="va">fishery</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sel_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">real_age</span>, y <span class="op">=</span> <span class="va">selectivity</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">fleet_name</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age (years)"</span>, y <span class="op">=</span> <span class="st">"Selectivity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="bet_files/figure-html/plot-selectivity-1.png" class="r-plt" alt="Selectivity-at-Age by Fleet" width="960"><p class="caption">
Selectivity-at-Age by Fleet
</p>
</div>
</div>
<div class="section level3">
<h3 id="diagnostics">Diagnostics<a class="anchor" aria-label="anchor" href="#diagnostics"></a>
</h3>
<p>Check that all parameters are estimable using the
<code>check_estimability</code> function:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_estimability.html">check_estimability</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">obj</span><span class="op">)</span></span>
<span><span class="co">#&gt; outer mgc:  2.130348e+18</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `check_estimability()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Some gradients are high, please improve optimization and only then use `Check_Identifiable`</span></span></code></pre></div>
<p>Calculate standard deviations of all model parameters:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Report</span> <span class="op">&lt;-</span> <span class="fu">sdreport</span><span class="op">(</span><span class="va">obj</span><span class="op">)</span></span>
<span><span class="co">#&gt; outer mgc:  2.130348e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  4.296325 </span></span>
<span><span class="co">#&gt; outer mgc:  5.563336 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  1.710657e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.792839e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  1.656782e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.910186e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  1.597276e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  3.064106e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  1.521359e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  3.279405e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  1.460298e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  3.488138e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  1.372371e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  3.859093e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  1.303603e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  4.224489e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  1.231213e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  4.690617e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  1.181449e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  5.100197e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  1.096796e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  6.034067e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  1.025675e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  7.112092e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  9.478814e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  8.874361e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  9.301376e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  9.429865e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  8.593336e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  1.235536e+19 </span></span>
<span><span class="co">#&gt; outer mgc:  8.378147e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  1.373092e+19 </span></span>
<span><span class="co">#&gt; outer mgc:  8.116149e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  1.561164e+19 </span></span>
<span><span class="co">#&gt; outer mgc:  8.308213e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  1.417936e+19 </span></span>
<span><span class="co">#&gt; outer mgc:  7.763226e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  1.940777e+19 </span></span>
<span><span class="co">#&gt; outer mgc:  7.529327e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  2.262918e+19 </span></span>
<span><span class="co">#&gt; outer mgc:  7.252411e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  2.808168e+19 </span></span>
<span><span class="co">#&gt; outer mgc:  7.449403e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  2.391647e+19 </span></span>
<span><span class="co">#&gt; outer mgc:  6.670067e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  5.211681e+19 </span></span>
<span><span class="co">#&gt; outer mgc:  6.189917e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  1.209889e+20 </span></span>
<span><span class="co">#&gt; outer mgc:  5.657148e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  8.805438e+20 </span></span>
<span><span class="co">#&gt; outer mgc:  5.514685e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  3.613392e+21 </span></span>
<span><span class="co">#&gt; outer mgc:  4.722627e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  1.183724e+20 </span></span>
<span><span class="co">#&gt; outer mgc:  4.237624e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  3.349524e+19 </span></span>
<span><span class="co">#&gt; outer mgc:  3.793339e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  1.48128e+19 </span></span>
<span><span class="co">#&gt; outer mgc:  3.504727e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  9.396998e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  3.042597e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  4.977054e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.696051e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  3.168257e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.361131e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  2.075289e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.077329e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  1.452752e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  1.769196e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  9.740933e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  1.492266e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  6.67168e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  1.280197e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  4.88789e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  1.142295e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  3.931708e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  1.004208e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  3.11961e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  8.783437e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  2.47641e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  7.725193e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  2.006178e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  6.763784e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  1.626884e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  5.741299e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  1.269238e+17 </span></span>
<span><span class="co">#&gt; outer mgc:  4.763456e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  9.672089e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  3.8698e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  7.239523e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  3.163383e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  5.522499e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  2.491127e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  4.05196e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  1.986328e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  3.048655e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  1.648261e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  2.426345e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  1.410742e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  2.012437e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  1.204206e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  1.668227e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  1.042598e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  1.409783e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  9.124659e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  1.208311e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  8.113242e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  1.056257e+16 </span></span>
<span><span class="co">#&gt; outer mgc:  7.071505e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  9.039775e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  6.134171e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  7.703193e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  5.281817e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  6.519588e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  4.501825e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  5.464316e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  3.653991e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  4.348382e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  2.893839e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  3.37662e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  2.282322e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  2.616448e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  1.929948e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  2.188008e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  1.630047e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  1.829157e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  1.436796e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  1.600687e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  1.325395e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  1.470312e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  1.254975e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  1.388372e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  1.092688e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  1.200678e+15 </span></span>
<span><span class="co">#&gt; outer mgc:  8.869934e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  9.655363e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  6.98822e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  7.535183e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  5.284076e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  5.642932e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  3.743663e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  3.957096e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  2.684775e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  2.814454e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  2.047134e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  2.133559e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  1.652159e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  1.715026e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  1.397028e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  1.446013e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  1.269272e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  1.311767e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  1.207103e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  1.246531e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  1.165997e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  1.203491e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  1.084486e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  1.118175e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  9.735542e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  1.002265e+14 </span></span>
<span><span class="co">#&gt; outer mgc:  8.358162e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  8.587301e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  6.744288e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  6.911628e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  5.150339e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  5.263022e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  3.842335e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  3.915781e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  2.791287e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  2.837491e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  2.052539e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  2.082246e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  1.515518e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  1.534751e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  1.161019e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  1.174164e+13 </span></span>
<span><span class="co">#&gt; outer mgc:  9.245745e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  9.341098e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  7.610328e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  7.682969e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  6.40257e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  6.459589e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  5.444456e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  5.48994e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  4.527808e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  4.56307e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  3.643885e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  3.670123e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  2.842136e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  2.860827e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  2.257026e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  2.270691e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  1.897428e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  1.908257e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  1.818826e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  1.829204e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  1.686419e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  1.695732e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  1.551059e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  1.559354e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  1.3802e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  1.387316e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  1.224569e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  1.230735e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  1.026768e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  1.031632e+12 </span></span>
<span><span class="co">#&gt; outer mgc:  887411514138 </span></span>
<span><span class="co">#&gt; outer mgc:  891428576337 </span></span>
<span><span class="co">#&gt; outer mgc:  778847125692 </span></span>
<span><span class="co">#&gt; outer mgc:  782237634336 </span></span>
<span><span class="co">#&gt; outer mgc:  757929216529 </span></span>
<span><span class="co">#&gt; outer mgc:  761294577946 </span></span>
<span><span class="co">#&gt; outer mgc:  680149502284 </span></span>
<span><span class="co">#&gt; outer mgc:  683028146420 </span></span>
<span><span class="co">#&gt; outer mgc:  612737232136 </span></span>
<span><span class="co">#&gt; outer mgc:  615239535952 </span></span>
<span><span class="co">#&gt; outer mgc:  536411472582 </span></span>
<span><span class="co">#&gt; outer mgc:  538530510214 </span></span>
<span><span class="co">#&gt; outer mgc:  4.62343e+11 </span></span>
<span><span class="co">#&gt; outer mgc:  464140248025 </span></span>
<span><span class="co">#&gt; outer mgc:  354225757659 </span></span>
<span><span class="co">#&gt; outer mgc:  355496382503 </span></span>
<span><span class="co">#&gt; outer mgc:  264500085500 </span></span>
<span><span class="co">#&gt; outer mgc:  265385144489 </span></span>
<span><span class="co">#&gt; outer mgc:  190026171748 </span></span>
<span><span class="co">#&gt; outer mgc:  190619687953 </span></span>
<span><span class="co">#&gt; outer mgc:  136756865137 </span></span>
<span><span class="co">#&gt; outer mgc:  137161900368 </span></span>
<span><span class="co">#&gt; outer mgc:  97981084873 </span></span>
<span><span class="co">#&gt; outer mgc:  98252523931 </span></span>
<span><span class="co">#&gt; outer mgc:  74395944158 </span></span>
<span><span class="co">#&gt; outer mgc:  74593502673 </span></span>
<span><span class="co">#&gt; outer mgc:  58061579074 </span></span>
<span><span class="co">#&gt; outer mgc:  58210619322 </span></span>
<span><span class="co">#&gt; outer mgc:  47362657922 </span></span>
<span><span class="co">#&gt; outer mgc:  47482444593 </span></span>
<span><span class="co">#&gt; outer mgc:  39798985706 </span></span>
<span><span class="co">#&gt; outer mgc:  39896868003 </span></span>
<span><span class="co">#&gt; outer mgc:  34427457924 </span></span>
<span><span class="co">#&gt; outer mgc:  34510443507 </span></span>
<span><span class="co">#&gt; outer mgc:  29638736030 </span></span>
<span><span class="co">#&gt; outer mgc:  29709188864 </span></span>
<span><span class="co">#&gt; outer mgc:  25695275887 </span></span>
<span><span class="co">#&gt; outer mgc:  25756727074 </span></span>
<span><span class="co">#&gt; outer mgc:  21066597585 </span></span>
<span><span class="co">#&gt; outer mgc:  21115145661 </span></span>
<span><span class="co">#&gt; outer mgc:  1.7239e+10 </span></span>
<span><span class="co">#&gt; outer mgc:  17277796794 </span></span>
<span><span class="co">#&gt; outer mgc:  14212755221 </span></span>
<span><span class="co">#&gt; outer mgc:  14244339769 </span></span>
<span><span class="co">#&gt; outer mgc:  12012416488 </span></span>
<span><span class="co">#&gt; outer mgc:  12039581918 </span></span>
<span><span class="co">#&gt; outer mgc:  9432433541 </span></span>
<span><span class="co">#&gt; outer mgc:  9453050403 </span></span>
<span><span class="co">#&gt; outer mgc:  7242462855 </span></span>
<span><span class="co">#&gt; outer mgc:  7257794769 </span></span>
<span><span class="co">#&gt; outer mgc:  5712522095 </span></span>
<span><span class="co">#&gt; outer mgc:  5724485758 </span></span>
<span><span class="co">#&gt; outer mgc:  4672024287 </span></span>
<span><span class="co">#&gt; outer mgc:  4681917989 </span></span>
<span><span class="co">#&gt; outer mgc:  3690723742 </span></span>
<span><span class="co">#&gt; outer mgc:  3698400941 </span></span>
<span><span class="co">#&gt; outer mgc:  2890468457 </span></span>
<span><span class="co">#&gt; outer mgc:  2896285630 </span></span>
<span><span class="co">#&gt; outer mgc:  2437180178 </span></span>
<span><span class="co">#&gt; outer mgc:  2442057960 </span></span>
<span><span class="co">#&gt; outer mgc:  2213700796 </span></span>
<span><span class="co">#&gt; outer mgc:  2218228621 </span></span>
<span><span class="co">#&gt; outer mgc:  2036331638 </span></span>
<span><span class="co">#&gt; outer mgc:  2040462331 </span></span>
<span><span class="co">#&gt; outer mgc:  1919699956 </span></span>
<span><span class="co">#&gt; outer mgc:  1923543156 </span></span>
<span><span class="co">#&gt; outer mgc:  1799128203 </span></span>
<span><span class="co">#&gt; outer mgc:  1802727235 </span></span>
<span><span class="co">#&gt; outer mgc:  1706800833 </span></span>
<span><span class="co">#&gt; outer mgc:  1710307916 </span></span>
<span><span class="co">#&gt; outer mgc:  1499698164 </span></span>
<span><span class="co">#&gt; outer mgc:  1502738256 </span></span>
<span><span class="co">#&gt; outer mgc:  1238619091 </span></span>
<span><span class="co">#&gt; outer mgc:  1241085712 </span></span>
<span><span class="co">#&gt; outer mgc:  981587246 </span></span>
<span><span class="co">#&gt; outer mgc:  983525433 </span></span>
<span><span class="co">#&gt; outer mgc:  768187957 </span></span>
<span><span class="co">#&gt; outer mgc:  769742759 </span></span>
<span><span class="co">#&gt; outer mgc:  555058860 </span></span>
<span><span class="co">#&gt; outer mgc:  556161499 </span></span>
<span><span class="co">#&gt; outer mgc:  364150030 </span></span>
<span><span class="co">#&gt; outer mgc:  364852860 </span></span>
<span><span class="co">#&gt; outer mgc:  243595589 </span></span>
<span><span class="co">#&gt; outer mgc:  244062371 </span></span>
<span><span class="co">#&gt; outer mgc:  168307810 </span></span>
<span><span class="co">#&gt; outer mgc:  168630327 </span></span>
<span><span class="co">#&gt; outer mgc:  127698337 </span></span>
<span><span class="co">#&gt; outer mgc:  127939399 </span></span>
<span><span class="co">#&gt; outer mgc:  111416277 </span></span>
<span><span class="co">#&gt; outer mgc:  111623809 </span></span>
<span><span class="co">#&gt; outer mgc:  105010539 </span></span>
<span><span class="co">#&gt; outer mgc:  105207191 </span></span>
<span><span class="co">#&gt; outer mgc:  100473962 </span></span>
<span><span class="co">#&gt; outer mgc:  100667076 </span></span>
<span><span class="co">#&gt; outer mgc:  90322135 </span></span>
<span><span class="co">#&gt; outer mgc:  90493453 </span></span>
<span><span class="co">#&gt; outer mgc:  77752123 </span></span>
<span><span class="co">#&gt; outer mgc:  77897670 </span></span>
<span><span class="co">#&gt; outer mgc:  63962303 </span></span>
<span><span class="co">#&gt; outer mgc:  64081140 </span></span>
<span><span class="co">#&gt; outer mgc:  51674803 </span></span>
<span><span class="co">#&gt; outer mgc:  51772221 </span></span>
<span><span class="co">#&gt; outer mgc:  41536896 </span></span>
<span><span class="co">#&gt; outer mgc:  41614526 </span></span>
<span><span class="co">#&gt; outer mgc:  32882250 </span></span>
<span><span class="co">#&gt; outer mgc:  32941681 </span></span>
<span><span class="co">#&gt; outer mgc:  28425187 </span></span>
<span><span class="co">#&gt; outer mgc:  28476186 </span></span>
<span><span class="co">#&gt; outer mgc:  26860803 </span></span>
<span><span class="co">#&gt; outer mgc:  26909604 </span></span>
<span><span class="co">#&gt; outer mgc:  25903359 </span></span>
<span><span class="co">#&gt; outer mgc:  25950605 </span></span>
<span><span class="co">#&gt; outer mgc:  25266027 </span></span>
<span><span class="co">#&gt; outer mgc:  25312790 </span></span>
<span><span class="co">#&gt; outer mgc:  23598462 </span></span>
<span><span class="co">#&gt; outer mgc:  23642338 </span></span>
<span><span class="co">#&gt; outer mgc:  20518342 </span></span>
<span><span class="co">#&gt; outer mgc:  20556441 </span></span>
<span><span class="co">#&gt; outer mgc:  17586631 </span></span>
<span><span class="co">#&gt; outer mgc:  17619230 </span></span>
<span><span class="co">#&gt; outer mgc:  14836602 </span></span>
<span><span class="co">#&gt; outer mgc:  14863863 </span></span>
<span><span class="co">#&gt; outer mgc:  12659022 </span></span>
<span><span class="co">#&gt; outer mgc:  12682222 </span></span>
<span><span class="co">#&gt; outer mgc:  11404880 </span></span>
<span><span class="co">#&gt; outer mgc:  11426155 </span></span>
<span><span class="co">#&gt; outer mgc:  10197685 </span></span>
<span><span class="co">#&gt; outer mgc:  10216621 </span></span>
<span><span class="co">#&gt; outer mgc:  8973884 </span></span>
<span><span class="co">#&gt; outer mgc:  8990453 </span></span>
<span><span class="co">#&gt; outer mgc:  7474901 </span></span>
<span><span class="co">#&gt; outer mgc:  7488660 </span></span>
<span><span class="co">#&gt; outer mgc:  5927490 </span></span>
<span><span class="co">#&gt; outer mgc:  5938588 </span></span>
<span><span class="co">#&gt; outer mgc:  4442664 </span></span>
<span><span class="co">#&gt; outer mgc:  4450961 </span></span>
<span><span class="co">#&gt; outer mgc:  3005631 </span></span>
<span><span class="co">#&gt; outer mgc:  3011101 </span></span>
<span><span class="co">#&gt; outer mgc:  1942377 </span></span>
<span><span class="co">#&gt; outer mgc:  1945842 </span></span>
<span><span class="co">#&gt; outer mgc:  1261445 </span></span>
<span><span class="co">#&gt; outer mgc:  1263660 </span></span>
<span><span class="co">#&gt; outer mgc:  856916.2 </span></span>
<span><span class="co">#&gt; outer mgc:  858372.2 </span></span>
<span><span class="co">#&gt; outer mgc:  704507.7 </span></span>
<span><span class="co">#&gt; outer mgc:  705684.5 </span></span>
<span><span class="co">#&gt; outer mgc:  677908.5 </span></span>
<span><span class="co">#&gt; outer mgc:  679034.7 </span></span>
<span><span class="co">#&gt; outer mgc:  750753.3 </span></span>
<span><span class="co">#&gt; outer mgc:  752030.8 </span></span>
<span><span class="co">#&gt; outer mgc:  866578.9 </span></span>
<span><span class="co">#&gt; outer mgc:  868102.5 </span></span>
<span><span class="co">#&gt; outer mgc:  922820.8 </span></span>
<span><span class="co">#&gt; outer mgc:  924451.7 </span></span>
<span><span class="co">#&gt; outer mgc:  864200.4 </span></span>
<span><span class="co">#&gt; outer mgc:  865692.9 </span></span>
<span><span class="co">#&gt; outer mgc:  750411.6 </span></span>
<span><span class="co">#&gt; outer mgc:  751735.1 </span></span>
<span><span class="co">#&gt; outer mgc:  632047 </span></span>
<span><span class="co">#&gt; outer mgc:  633152.7 </span></span>
<span><span class="co">#&gt; outer mgc:  470545.7 </span></span>
<span><span class="co">#&gt; outer mgc:  471333.2 </span></span>
<span><span class="co">#&gt; outer mgc:  343321.8 </span></span>
<span><span class="co">#&gt; outer mgc:  343885.8 </span></span>
<span><span class="co">#&gt; outer mgc:  247386.6 </span></span>
<span><span class="co">#&gt; outer mgc:  247788.2 </span></span>
<span><span class="co">#&gt; outer mgc:  185018.4 </span></span>
<span><span class="co">#&gt; outer mgc:  185307.6 </span></span>
<span><span class="co">#&gt; outer mgc:  155519.7 </span></span>
<span><span class="co">#&gt; outer mgc:  155763.7 </span></span>
<span><span class="co">#&gt; outer mgc:  152117.3 </span></span>
<span><span class="co">#&gt; outer mgc:  152366.3 </span></span>
<span><span class="co">#&gt; outer mgc:  142314.9 </span></span>
<span><span class="co">#&gt; outer mgc:  142554.9 </span></span>
<span><span class="co">#&gt; outer mgc:  123564.6 </span></span>
<span><span class="co">#&gt; outer mgc:  123771.1 </span></span>
<span><span class="co">#&gt; outer mgc:  100360.9 </span></span>
<span><span class="co">#&gt; outer mgc:  100526.6 </span></span>
<span><span class="co">#&gt; outer mgc:  85069.26 </span></span>
<span><span class="co">#&gt; outer mgc:  85212.84 </span></span>
<span><span class="co">#&gt; outer mgc:  65023.93 </span></span>
<span><span class="co">#&gt; outer mgc:  65134.2 </span></span>
<span><span class="co">#&gt; outer mgc:  47297.9 </span></span>
<span><span class="co">#&gt; outer mgc:  47375.73 </span></span>
<span><span class="co">#&gt; outer mgc:  39297.61 </span></span>
<span><span class="co">#&gt; outer mgc:  39361.07 </span></span>
<span><span class="co">#&gt; outer mgc:  40637.62 </span></span>
<span><span class="co">#&gt; outer mgc:  40704.09 </span></span>
<span><span class="co">#&gt; outer mgc:  44865.56 </span></span>
<span><span class="co">#&gt; outer mgc:  44941.36 </span></span>
<span><span class="co">#&gt; outer mgc:  49146.49 </span></span>
<span><span class="co">#&gt; outer mgc:  49232.66 </span></span>
<span><span class="co">#&gt; outer mgc:  48990.33 </span></span>
<span><span class="co">#&gt; outer mgc:  49077.42 </span></span>
<span><span class="co">#&gt; outer mgc:  39784.66 </span></span>
<span><span class="co">#&gt; outer mgc:  39853.79 </span></span>
<span><span class="co">#&gt; outer mgc:  30461.83 </span></span>
<span><span class="co">#&gt; outer mgc:  30514.68 </span></span>
<span><span class="co">#&gt; outer mgc:  22552.74 </span></span>
<span><span class="co">#&gt; outer mgc:  22591.08 </span></span>
<span><span class="co">#&gt; outer mgc:  16820.93 </span></span>
<span><span class="co">#&gt; outer mgc:  16848.45 </span></span>
<span><span class="co">#&gt; outer mgc:  13703.46 </span></span>
<span><span class="co">#&gt; outer mgc:  13725.23 </span></span>
<span><span class="co">#&gt; outer mgc:  13175.36 </span></span>
<span><span class="co">#&gt; outer mgc:  13196.88 </span></span>
<span><span class="co">#&gt; outer mgc:  12438.24 </span></span>
<span><span class="co">#&gt; outer mgc:  12458.64 </span></span>
<span><span class="co">#&gt; outer mgc:  10697.58 </span></span>
<span><span class="co">#&gt; outer mgc:  10714.9 </span></span>
<span><span class="co">#&gt; outer mgc:  8765.26 </span></span>
<span><span class="co">#&gt; outer mgc:  8779.314 </span></span>
<span><span class="co">#&gt; outer mgc:  7349.482 </span></span>
<span><span class="co">#&gt; outer mgc:  7361.639 </span></span>
<span><span class="co">#&gt; outer mgc:  5863.047 </span></span>
<span><span class="co">#&gt; outer mgc:  5872.44 </span></span>
<span><span class="co">#&gt; outer mgc:  4639.3 </span></span>
<span><span class="co">#&gt; outer mgc:  4646.457 </span></span>
<span><span class="co">#&gt; outer mgc:  3975.614 </span></span>
<span><span class="co">#&gt; outer mgc:  3981.586 </span></span>
<span><span class="co">#&gt; outer mgc:  3853.217 </span></span>
<span><span class="co">#&gt; outer mgc:  3859.167 </span></span>
<span><span class="co">#&gt; outer mgc:  3801.636 </span></span>
<span><span class="co">#&gt; outer mgc:  3807.493 </span></span>
<span><span class="co">#&gt; outer mgc:  3551.149 </span></span>
<span><span class="co">#&gt; outer mgc:  3556.555 </span></span>
<span><span class="co">#&gt; outer mgc:  3223.82 </span></span>
<span><span class="co">#&gt; outer mgc:  3228.663 </span></span>
<span><span class="co">#&gt; outer mgc:  2936.129 </span></span>
<span><span class="co">#&gt; outer mgc:  2940.721 </span></span>
<span><span class="co">#&gt; outer mgc:  2589.232 </span></span>
<span><span class="co">#&gt; outer mgc:  2593.253 </span></span>
<span><span class="co">#&gt; outer mgc:  2013.931 </span></span>
<span><span class="co">#&gt; outer mgc:  2016.78 </span></span>
<span><span class="co">#&gt; outer mgc:  1590.468 </span></span>
<span><span class="co">#&gt; outer mgc:  1592.527 </span></span>
<span><span class="co">#&gt; outer mgc:  1466.518 </span></span>
<span><span class="co">#&gt; outer mgc:  1468.447 </span></span>
<span><span class="co">#&gt; outer mgc:  1443.225 </span></span>
<span><span class="co">#&gt; outer mgc:  1445.187 </span></span>
<span><span class="co">#&gt; outer mgc:  1369.061 </span></span>
<span><span class="co">#&gt; outer mgc:  1370.892 </span></span>
<span><span class="co">#&gt; outer mgc:  1272.86 </span></span>
<span><span class="co">#&gt; outer mgc:  1274.52 </span></span>
<span><span class="co">#&gt; outer mgc:  1231.428 </span></span>
<span><span class="co">#&gt; outer mgc:  1233.055 </span></span>
<span><span class="co">#&gt; outer mgc:  1263.722 </span></span>
<span><span class="co">#&gt; outer mgc:  1265.454 </span></span>
<span><span class="co">#&gt; outer mgc:  1271.673 </span></span>
<span><span class="co">#&gt; outer mgc:  1273.462 </span></span>
<span><span class="co">#&gt; outer mgc:  1189.01 </span></span>
<span><span class="co">#&gt; outer mgc:  1190.653 </span></span>
<span><span class="co">#&gt; outer mgc:  1008.111 </span></span>
<span><span class="co">#&gt; outer mgc:  1009.454 </span></span>
<span><span class="co">#&gt; outer mgc:  882.4888 </span></span>
<span><span class="co">#&gt; outer mgc:  883.6487 </span></span>
<span><span class="co">#&gt; outer mgc:  651.9675 </span></span>
<span><span class="co">#&gt; outer mgc:  652.7169 </span></span>
<span><span class="co">#&gt; outer mgc:  436.349 </span></span>
<span><span class="co">#&gt; outer mgc:  436.6783 </span></span>
<span><span class="co">#&gt; outer mgc:  335.4562 </span></span>
<span><span class="co">#&gt; outer mgc:  335.6685 </span></span>
<span><span class="co">#&gt; outer mgc:  293.8545 </span></span>
<span><span class="co">#&gt; outer mgc:  294.0846 </span></span>
<span><span class="co">#&gt; outer mgc:  199.9242 </span></span>
<span><span class="co">#&gt; outer mgc:  200.0563 </span></span>
<span><span class="co">#&gt; outer mgc:  85.90603 </span></span>
<span><span class="co">#&gt; outer mgc:  85.85117 </span></span>
<span><span class="co">#&gt; outer mgc:  33.31877 </span></span>
<span><span class="co">#&gt; outer mgc:  33.19615 </span></span>
<span><span class="co">#&gt; outer mgc:  17.59587 </span></span>
<span><span class="co">#&gt; outer mgc:  17.48443 </span></span>
<span><span class="co">#&gt; outer mgc:  9.163233 </span></span>
<span><span class="co">#&gt; outer mgc:  9.076578 </span></span>
<span><span class="co">#&gt; outer mgc:  18.18635 </span></span>
<span><span class="co">#&gt; outer mgc:  18.05288 </span></span>
<span><span class="co">#&gt; outer mgc:  1.705982 </span></span>
<span><span class="co">#&gt; outer mgc:  1.810472 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18 </span></span>
<span><span class="co">#&gt; outer mgc:  2.155537e+18</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h2>
<p>The CPUE series is set up using RTMB’s <code>OBS</code> mechanism
inside the model, which allows simulation via
<code>obj$simulate()</code>. For example:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">cpue_data</span><span class="op">$</span><span class="va">value</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">2</span>, pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time step"</span>, ylab <span class="op">=</span> <span class="st">"log(CPUE)"</span>, main <span class="op">=</span> <span class="st">"Observed vs simulated CPUE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">cpue_pred</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">cpue_log_obs</span>, col <span class="op">=</span> <span class="st">"gray70"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bet_files/figure-html/sim-1-1.png" class="r-plt" alt="" width="672"></p>
<div class="section level3">
<h3 id="one-step-ahead-osa-residuals">One step ahead (OSA) residuals<a class="anchor" aria-label="anchor" href="#one-step-ahead-osa-residuals"></a>
</h3>
<p>OSA residuals are a replacement for Pearson residuals:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">osa_cpue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RTMB/man/OSA-residuals.html" class="external-link">oneStepPredict</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">obj</span>, observation.name <span class="op">=</span> <span class="st">"cpue_log_obs"</span>,</span>
<span>                           method <span class="op">=</span> <span class="st">"oneStepGeneric"</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqnorm</a></span><span class="op">(</span><span class="va">osa_cpue</span><span class="op">$</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="bet_files/figure-html/osa1-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">osa_cpue</span><span class="op">$</span><span class="va">res</span>, xlab <span class="op">=</span> <span class="st">"Index"</span>, ylab <span class="op">=</span> <span class="st">"OSA residual"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="bet_files/figure-html/osa1-2.png" class="r-plt" alt="" width="672"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Darcy Webber, Philipp Neubauer, Nicholas Ducharme-Barth.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
