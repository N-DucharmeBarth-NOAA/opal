<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The BET model • opal</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Montserrat-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The BET model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">opal</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bet.html">The BET model</a></li>
    <li><a class="dropdown-item" href="../articles/quickstart.html">Quickstart Guide</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/N-DucharmeBarth-NOAA/opal" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/N-DucharmeBarth-NOAA/opal/issues" aria-label="Report an issue"><span class="fa fas fa-bug"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>The BET model</h1>
            
      

      <div class="d-none name"><code>bet.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>opal</code> is an open, modular R package for fisheries stock
assessment built on <a href="https://github.com/kaskr/RTMB" class="external-link">RTMB</a> for
automatic differentiation. It includes bundled data from the western and
central Pacific Ocean (WCPO) bigeye tuna (BET) stock assessment. This
vignette demonstrates model setup, fitting, and diagnostics using those
data.</p>
</div>
<div class="section level2">
<h2 id="load-inputs">Load inputs<a class="anchor" aria-label="anchor" href="#load-inputs"></a>
</h2>
<p>Load the <code>opal</code> package and the <code>RTMB</code>
dependency. The <code>ggplot2</code> package is used for plotting.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># library(ggplot2)</span></span>
<span><span class="co"># library(dplyr)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://n-ducharmebarth-noaa.github.io/opal/">opal</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kaskr/RTMB" class="external-link">RTMB</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The bundled data object <code>wcpo_bet_data</code> contains all
biological parameters, catch and CPUE observations, length structure,
and prior specifications needed for the BET assessment model:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">wcpo_bet_data</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">wcpo_bet_data</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "age_a"          "n_age"          "n_season"       "n_fishery"     </span></span>
<span><span class="co">#&gt;  [5] "len_bin_start"  "len_bin_width"  "n_len"          "first_yr"      </span></span>
<span><span class="co">#&gt;  [9] "last_yr"        "years"          "n_year"         "first_yr_catch"</span></span>
<span><span class="co">#&gt; [13] "catch_units_f"  "cpue_switch"    "cpue_data"      "A1"            </span></span>
<span><span class="co">#&gt; [17] "A2"             "lw_a"           "lw_b"           "maturity"      </span></span>
<span><span class="co">#&gt; [21] "fecundity"      "M"              "catch_obs_ysf"  "sel_type_f"    </span></span>
<span><span class="co">#&gt; [25] "priors"</span></span></code></pre></div>
<p>Key dimensions of the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of ages:"</span>, <span class="va">data</span><span class="op">$</span><span class="va">n_age</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of ages: 40</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of years:"</span>, <span class="va">data</span><span class="op">$</span><span class="va">n_year</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of years: 268</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of fisheries:"</span>, <span class="va">data</span><span class="op">$</span><span class="va">n_fishery</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of fisheries: 15</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of length bins:"</span>, <span class="va">data</span><span class="op">$</span><span class="va">n_len</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of length bins: 95</span></span></code></pre></div>
<div class="section level3">
<h3 id="biological-inputs">Biological inputs<a class="anchor" aria-label="anchor" href="#biological-inputs"></a>
</h3>
<p>Natural mortality at age, maturity at length, and length-weight
parameters are all contained in the data object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ages</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">age_a</span></span>
<span><span class="va">real_age</span> <span class="op">&lt;-</span> <span class="va">ages</span> <span class="op">/</span> <span class="fl">4</span></span>
<span></span>
<span><span class="co"># Natural mortality</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>age <span class="op">=</span> <span class="va">real_age</span>, M <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">M</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">M</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age (years)"</span>, y <span class="op">=</span> <span class="st">"M (quarterly rate)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Natural Mortality-at-Age"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bet_files/figure-html/plot-biology-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Maturity at length</span></span>
<span><span class="va">len_mid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">len_bin_start</span> <span class="op">+</span> <span class="va">data</span><span class="op">$</span><span class="va">len_bin_width</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>               by <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">len_bin_width</span>, length.out <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">n_len</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>length <span class="op">=</span> <span class="va">len_mid</span>, maturity <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">maturity</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span>, y <span class="op">=</span> <span class="va">maturity</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Length (cm)"</span>, y <span class="op">=</span> <span class="st">"Maturity"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Maturity-at-Length"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bet_files/figure-html/plot-biology-2.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="length-composition-data">Length composition data<a class="anchor" aria-label="anchor" href="#length-composition-data"></a>
</h3>
<p>Length composition observations are loaded from the bundled
<code>wcpo_bet_lf</code> long-format data object and transformed into
model-ready arrays.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">wcpo_bet_lf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pivot to wide format: one row per fishery x timestep, bins as columns</span></span>
<span><span class="co"># Note: LF data exist for fisheries 8-14, but we initially use only fisheries 8 &amp; 9</span></span>
<span><span class="va">lf_wide</span> <span class="op">&lt;-</span> <span class="va">wcpo_bet_lf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fishery</span>, <span class="va">year</span>, <span class="va">month</span>, <span class="va">ts</span><span class="op">)</span>,</span>
<span>    names_from <span class="op">=</span> <span class="va">bin</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">value</span>,</span>
<span>    values_fill <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">fishery</span>, <span class="va">ts</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define variance adjustment scalars for each fishery if using lf_switch = 1 (multinomial)</span></span>
<span><span class="va">var_adjust_scalars</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">data</span><span class="op">$</span><span class="va">n_fishery</span><span class="op">)</span></span>
<span><span class="co"># var_adjust_scalars &lt;- 1/rep(20000,data$n_fishery)</span></span>
<span><span class="co"># var_adjust_scalars[c(1,4,5,6,15)] &lt;- 1/40000</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_lf_data.html">prep_lf_data</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">lf_wide</span>, lf_keep_fisheries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                     lf_var_adjust <span class="op">=</span> <span class="va">var_adjust_scalars</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="weight-composition-data">Weight composition data<a class="anchor" aria-label="anchor" href="#weight-composition-data"></a>
</h3>
<p>Weight composition observations are loaded from the bundled
<code>wcpo_bet_wf</code> long-format data object and transformed into
model-ready arrays.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">wcpo_bet_wf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Weight bin scalars (1 kg bins, 1–200 kg)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">wt_bin_start</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">wt_bin_width</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">n_wt</span>         <span class="op">&lt;-</span> <span class="fl">200L</span></span>
<span></span>
<span><span class="co"># Pivot to wide format: one row per fishery x timestep, bins as columns</span></span>
<span><span class="va">wf_wide</span> <span class="op">&lt;-</span> <span class="va">wcpo_bet_wf</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    id_cols     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fishery</span>, <span class="va">year</span>, <span class="va">month</span>, <span class="va">ts</span><span class="op">)</span>,</span>
<span>    names_from  <span class="op">=</span> <span class="va">bin</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">value</span>,</span>
<span>    values_fill <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">fishery</span>, <span class="va">ts</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_wf_data.html">prep_wf_data</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">wf_wide</span>,</span>
<span>                     wf_keep_fisheries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                     wf_switch <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="model-setup">Model setup<a class="anchor" aria-label="anchor" href="#model-setup"></a>
</h2>
<div class="section level3">
<h3 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h3>
<p>Define the initial parameter values. Growth parameters
(<code>log_L1</code>, <code>log_L2</code>, <code>log_k</code>,
<code>log_CV1</code>, <code>log_CV2</code>) and selectivity
(<code>par_sel</code>) are initialised at reasonable starting values.
Load these from the bundled <code>wcpo_bet_parameters</code> data
object:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">)</span></span>
<span></span>
<span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  log_B0 <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  log_h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_h</span><span class="op">)</span>,</span>
<span>  log_sigma_r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_sigma_r</span><span class="op">)</span>,</span>
<span>  log_cpue_q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_cpue_q</span><span class="op">)</span>,</span>
<span>  cpue_creep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">cpue_creep</span><span class="op">)</span>,</span>
<span>  log_cpue_tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_cpue_tau</span><span class="op">)</span>,</span>
<span>  log_cpue_omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_cpue_omega</span><span class="op">)</span>,</span>
<span>  log_lf_tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="va">data</span><span class="op">$</span><span class="va">n_fishery</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  log_wf_tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">data</span><span class="op">$</span><span class="va">n_fishery</span><span class="op">)</span>,</span>
<span>  log_L1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_L1</span><span class="op">)</span>,</span>
<span>  log_L2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_L2</span><span class="op">)</span>,</span>
<span>  log_k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_k</span><span class="op">)</span>,</span>
<span>  log_CV1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_CV1</span><span class="op">)</span>,</span>
<span>  log_CV2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">log_CV2</span><span class="op">)</span>,</span>
<span>  par_sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">par_sel</span><span class="op">)</span>,</span>
<span>  rdev_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wcpo_bet_parameters</span><span class="op">$</span><span class="va">rdev_y</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h3>
<p>Priors are specified using <code><a href="../reference/get_priors.html">get_priors()</a></code>. The data object
already contains prior center values for growth parameters:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span><span class="op">$</span><span class="va">priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_priors.html">get_priors</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">parameters</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/evaluate_priors.html">evaluate_priors</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">parameters</span>, priors <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">priors</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 92427.24</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parameter-map">Parameter map<a class="anchor" aria-label="anchor" href="#parameter-map"></a>
</h3>
<p>Use RTMB’s <code>map</code> option to turn parameters on/off.
Parameters mapped to <code>factor(NA)</code> are fixed at their initial
values:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">$</span><span class="va">par_sel</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">$</span><span class="va">par_sel</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">map_sel</span><span class="op">[</span><span class="fl">8</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">map_sel</span><span class="op">[</span><span class="fl">9</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">map_sel</span><span class="op">[</span><span class="fl">8</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">map_sel</span><span class="op">[</span><span class="fl">9</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">map_sel</span><span class="op">[</span><span class="fl">8</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">map_sel</span><span class="op">[</span><span class="fl">9</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">map_rdev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">$</span><span class="va">rdev_y</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">map_lf_tau</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">$</span><span class="va">log_lf_tau</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">map_lf_tau</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">9</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># log_B0 = factor(NA),</span></span>
<span>  log_h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  log_sigma_r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  <span class="co"># log_cpue_q = factor(NA),</span></span>
<span>  cpue_creep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  log_cpue_tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  log_cpue_omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  log_lf_tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">map_lf_tau</span><span class="op">)</span>,</span>
<span>  log_wf_tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">data</span><span class="op">$</span><span class="va">n_fishery</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># fixed initially</span></span>
<span>  log_L1  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  log_L2  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  log_k   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  log_CV1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  log_CV2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  par_sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">map_sel</span><span class="op">)</span></span>
<span>  <span class="co"># rdev_y = as.factor(map_rdev),</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="build-the-ad-object">Build the AD object<a class="anchor" aria-label="anchor" href="#build-the-ad-object"></a>
</h3>
<p>Using the <code>data</code>, the <code>parameters</code>, the
parameter <code>map</code>, and the model (<code>opal_model</code>), the
AD object is created using RTMB’s <code>MakeADFun</code> function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data$lf_switch &lt;- 1 # multinomial likelihood on flat counts (default)</span></span>
<span><span class="co"># data$lf_switch &lt;- 2 # fails while fitting, need to sort out log_lf_tau for this, use simulate to tune and find</span></span>
<span><span class="co"># data$lf_switch &lt;- 3 # fails - wants integers - think this should be an issue to RTMBdist guys</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">lf_switch</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># skip length comps (removal only)</span></span>
<span></span>
<span><span class="co"># Note: wf_switch was already set by prep_wf_data(); it is re-stated here for</span></span>
<span><span class="co"># clarity alongside the equivalent lf_switch assignment.</span></span>
<span><span class="co"># data$wf_switch &lt;- 2 # Dirichlet</span></span>
<span><span class="co"># data$wf_switch &lt;- 3 # Dirichlet-multinomial</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">wf_switch</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># skip weight comps (removal only)</span></span>
<span></span>
<span><span class="co"># Optionally, we could also specify random effects here (e.g. `random = "rdev_y"`), but we'll start with a simpler fixed-effects model to check everything is working first.</span></span>
<span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu">MakeADFun</span><span class="op">(</span>func <span class="op">=</span> <span class="fu"><a href="../reference/cmb.html">cmb</a></span><span class="op">(</span><span class="va">opal_model</span>, <span class="va">data</span><span class="op">)</span>, parameters <span class="op">=</span> <span class="va">parameters</span>, map <span class="op">=</span> <span class="va">map</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "log_B0"     "log_cpue_q" "rdev_y"</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">fn</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 696.6957</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">gr</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; outer mgc:  847.8735</span></span>
<span><span class="co">#&gt;         [,1]     [,2]      [,3]      [,4]      [,5]      [,6]      [,7]</span></span>
<span><span class="co">#&gt; [1,] 1.36223 847.8735 -14.42373 -17.79091 -11.96625 -12.08163 -23.62672</span></span>
<span><span class="co">#&gt;           [,8]      [,9]   [,10]     [,11]     [,12]     [,13]     [,14]</span></span>
<span><span class="co">#&gt; [1,] -17.25554 -17.79412 -22.425 -21.47014 -9.492821 -9.487044 -34.25533</span></span>
<span><span class="co">#&gt;          [,15]     [,16]     [,17]     [,18]     [,19]     [,20]     [,21]</span></span>
<span><span class="co">#&gt; [1,] -13.94379 -24.41818 -21.90769 -13.48098 -7.581473 -20.25592 -26.55708</span></span>
<span><span class="co">#&gt;          [,22]     [,23]     [,24]     [,25]     [,26]     [,27]     [,28]</span></span>
<span><span class="co">#&gt; [1,] -11.59815 -17.71142 -14.77482 -11.33643 -8.327975 -8.960074 -11.67251</span></span>
<span><span class="co">#&gt;          [,29]     [,30]     [,31]     [,32]     [,33]     [,34]     [,35]</span></span>
<span><span class="co">#&gt; [1,] -14.40482 -18.79487 -10.89254 -12.52937 -13.77129 -16.75682 -7.612175</span></span>
<span><span class="co">#&gt;          [,36]     [,37]     [,38]     [,39]     [,40]     [,41]     [,42]</span></span>
<span><span class="co">#&gt; [1,] -19.80659 -13.20922 -10.29418 -14.54024 -12.02668 -28.96289 -10.74707</span></span>
<span><span class="co">#&gt;          [,43]     [,44]     [,45]     [,46]     [,47]     [,48]     [,49]</span></span>
<span><span class="co">#&gt; [1,] -10.28152 -14.14101 -22.33511 -9.906668 -8.281704 -11.64379 -9.064911</span></span>
<span><span class="co">#&gt;         [,50]     [,51]     [,52]     [,53]     [,54]     [,55]     [,56]</span></span>
<span><span class="co">#&gt; [1,] -10.2941 -9.664533 -13.90955 -8.889439 -10.53537 -21.16136 -6.615962</span></span>
<span><span class="co">#&gt;         [,57]     [,58]    [,59]     [,60]     [,61]     [,62]     [,63]</span></span>
<span><span class="co">#&gt; [1,] -7.25638 -8.705425 -6.17196 -5.831573 -6.230935 -4.644877 -12.92899</span></span>
<span><span class="co">#&gt;          [,64]     [,65]     [,66]     [,67]     [,68]     [,69]     [,70]</span></span>
<span><span class="co">#&gt; [1,] -4.819591 -4.237939 -4.831417 -4.725637 -3.043372 -2.803211 -2.736426</span></span>
<span><span class="co">#&gt;          [,71]     [,72]     [,73]     [,74]     [,75]     [,76]     [,77]</span></span>
<span><span class="co">#&gt; [1,] -3.042287 -2.957644 -2.832817 -2.951742 -3.327376 -3.373636 -2.718246</span></span>
<span><span class="co">#&gt;          [,78]     [,79]     [,80]     [,81]      [,82]     [,83]     [,84]</span></span>
<span><span class="co">#&gt; [1,] -1.905599 -1.534254 -1.112567 -2.980091 -0.7524688 -3.513066 -1.777633</span></span>
<span><span class="co">#&gt;         [,85]     [,86]     [,87]     [,88]     [,89]     [,90]     [,91]</span></span>
<span><span class="co">#&gt; [1,] -2.77622 -2.898418 -3.203531 -3.533987 -3.949122 -3.965853 -3.891109</span></span>
<span><span class="co">#&gt;          [,92]     [,93]     [,94]     [,95]     [,96]     [,97]     [,98]</span></span>
<span><span class="co">#&gt; [1,] -3.869417 -3.657707 -3.873963 -3.423115 -2.867199 -2.524664 -2.428816</span></span>
<span><span class="co">#&gt;          [,99]    [,100]    [,101]   [,102]  [,103]    [,104]   [,105]   [,106]</span></span>
<span><span class="co">#&gt; [1,] -1.881653 0.1099419 0.8935999 4.313273 3.53943 -1.380832 3.849519 1.001104</span></span>
<span><span class="co">#&gt;        [,107]    [,108]   [,109]   [,110]   [,111]   [,112]     [,113]   [,114]</span></span>
<span><span class="co">#&gt; [1,] 1.260817 -1.860571 2.235185 1.621885 3.384444 3.651069 -0.4034103 10.06855</span></span>
<span><span class="co">#&gt;        [,115]   [,116]   [,117]   [,118]   [,119]   [,120]   [,121]   [,122]</span></span>
<span><span class="co">#&gt; [1,] 4.423438 7.950092 9.743676 2.905259 4.412664 10.42574 6.050362 5.262348</span></span>
<span><span class="co">#&gt;        [,123]   [,124]    [,125]    [,126]   [,127]   [,128]   [,129]   [,130]</span></span>
<span><span class="co">#&gt; [1,] 19.63047 1.499814 0.0709136 0.8013582 10.39791 13.36318 4.934542 17.81396</span></span>
<span><span class="co">#&gt;          [,131]   [,132]   [,133]   [,134]   [,135]   [,136]   [,137]   [,138]</span></span>
<span><span class="co">#&gt; [1,] -0.6327937 1.060031 2.913669 3.210989 2.645825 1.973106 8.814456 1.905641</span></span>
<span><span class="co">#&gt;          [,139]    [,140]   [,141]   [,142]   [,143]   [,144]  [,145]  [,146]</span></span>
<span><span class="co">#&gt; [1,] -0.5361419 -1.843739 16.19188 3.008929 2.066632 5.887302 1.33293 2.34599</span></span>
<span><span class="co">#&gt;        [,147]   [,148]   [,149]   [,150]    [,151]   [,152]   [,153]   [,154]</span></span>
<span><span class="co">#&gt; [1,] 2.694726 6.489514 1.825036 1.483763 0.3097918 7.556589 3.024082 9.470925</span></span>
<span><span class="co">#&gt;        [,155]   [,156]   [,157]   [,158]   [,159]  [,160]   [,161]   [,162]</span></span>
<span><span class="co">#&gt; [1,] 4.270987 5.030244 3.461459 5.489262 7.919619 4.12505 4.281111 1.847724</span></span>
<span><span class="co">#&gt;        [,163]   [,164]   [,165]    [,166]   [,167]   [,168]    [,169]   [,170]</span></span>
<span><span class="co">#&gt; [1,] 4.132976 2.679274 2.881558 0.5435661 2.279492 8.243004 -1.876656 8.524661</span></span>
<span><span class="co">#&gt;        [,171]   [,172]  [,173]   [,174]   [,175]   [,176]  [,177]   [,178]</span></span>
<span><span class="co">#&gt; [1,] 3.978502 1.049552 5.94895 4.913562 4.518005 4.382705 5.11398 4.263811</span></span>
<span><span class="co">#&gt;        [,179]   [,180]    [,181]   [,182]   [,183]   [,184]   [,185]   [,186]</span></span>
<span><span class="co">#&gt; [1,] 3.804904 1.952369 0.5251225 21.01821 7.529496 11.68518 10.81984 2.003909</span></span>
<span><span class="co">#&gt;        [,187]   [,188]   [,189]   [,190]   [,191]   [,192]  [,193]     [,194]</span></span>
<span><span class="co">#&gt; [1,] 25.51814 13.05216 6.110153 5.844232 12.74616 1.187579 9.65867 -0.8051976</span></span>
<span><span class="co">#&gt;        [,195]   [,196]   [,197]   [,198]   [,199]   [,200]   [,201]   [,202]</span></span>
<span><span class="co">#&gt; [1,] 5.905875 3.543131 3.104756 7.223417 4.720595 12.58776 12.51461 20.60459</span></span>
<span><span class="co">#&gt;        [,203]   [,204]   [,205]   [,206]   [,207]   [,208]    [,209]   [,210]</span></span>
<span><span class="co">#&gt; [1,] 15.85585 13.19304 14.98456 5.014382 7.704384 4.966446 0.9461077 8.565709</span></span>
<span><span class="co">#&gt;        [,211]   [,212]   [,213]   [,214]  [,215]   [,216]   [,217]   [,218]</span></span>
<span><span class="co">#&gt; [1,] 28.13899 31.12039 30.31993 11.78485 24.7352 6.036837 17.65149 22.38168</span></span>
<span><span class="co">#&gt;        [,219]   [,220]   [,221]   [,222]   [,223]  [,224]  [,225]   [,226]</span></span>
<span><span class="co">#&gt; [1,] 14.94333 14.78684 4.432771 16.58045 2.901582 11.1743 9.21042 11.13793</span></span>
<span><span class="co">#&gt;        [,227]   [,228]   [,229]   [,230]   [,231]   [,232]   [,233]     [,234]</span></span>
<span><span class="co">#&gt; [1,] 14.87578 14.09604 13.00995 18.83471 6.427051 13.80929 9.082483 -0.2643707</span></span>
<span><span class="co">#&gt;        [,235]   [,236]   [,237]   [,238]   [,239]   [,240]  [,241]   [,242]</span></span>
<span><span class="co">#&gt; [1,] 10.46214 31.25587 8.392217 9.580797 1.915908 6.143048 8.12524 4.091881</span></span>
<span><span class="co">#&gt;        [,243]   [,244]   [,245]   [,246]   [,247]  [,248]   [,249]   [,250]</span></span>
<span><span class="co">#&gt; [1,] 20.24496 9.960366 3.628648 2.183022 5.307158 9.07459 5.761786 5.801557</span></span>
<span><span class="co">#&gt;        [,251]       [,252]   [,253]   [,254]   [,255]   [,256]   [,257] [,258]</span></span>
<span><span class="co">#&gt; [1,] 6.351286 -0.001576827 8.981838 6.469136 5.821842 2.562364 12.84008 3.0483</span></span>
<span><span class="co">#&gt;        [,259]   [,260]   [,261]   [,262]    [,263]   [,264]   [,265]    [,266]</span></span>
<span><span class="co">#&gt; [1,] 5.601956 4.766498 2.654791 5.269718 0.8332309 1.495876 2.504979 -1.093281</span></span>
<span><span class="co">#&gt;          [,267]    [,268]    [,269]    [,270]</span></span>
<span><span class="co">#&gt; [1,] -0.7009227 -2.285167 -2.101524 0.6256006</span></span></code></pre></div>
<p>Inspect initial model outputs:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">spawning_biomass_y</span>, type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time step"</span>, ylab <span class="op">=</span> <span class="st">"Spawning biomass (mt)"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Initial spawning biomass trajectory"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bet_files/figure-html/init-checks-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_catch.html">plot_catch</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, obj <span class="op">=</span> <span class="va">obj</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The maximum catch difference was: 1.10394466901198e-08"</span></span></code></pre></div>
<p><img src="bet_files/figure-html/init-checks-2.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="parameter-bounds">Parameter bounds<a class="anchor" aria-label="anchor" href="#parameter-bounds"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Lwr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Upr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Lwr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"log_B0"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Upr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"log_B0"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">22</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Lwr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"log_cpue_q"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">Upr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"log_cpue_q"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">Lwr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"log_lf_tau"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">9</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"log_lf_tau"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Upr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"log_lf_tau"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"log_lf_tau"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Lwr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"rdev_y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"rdev_y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Upr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"rdev_y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"rdev_y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Lwr[grep("par_sel", names(obj$par))] &lt;- rep(-7, length(grep("par_sel", names(obj$par))))</span></span>
<span><span class="co"># Upr[grep("par_sel", names(obj$par))] &lt;- rep(7, length(grep("par_sel", names(obj$par))))</span></span>
<span><span class="va">bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">par</span><span class="op">)</span>, lower <span class="op">=</span> <span class="va">Lwr</span>, upper <span class="op">=</span> <span class="va">Upr</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="optimisation">Optimisation<a class="anchor" aria-label="anchor" href="#optimisation"></a>
</h2>
<p>Optimise using the <code>nlminb</code> function, do it twice to be
sure to be sure (said with Irish accent):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>eval.max <span class="op">=</span> <span class="fl">10000</span>, iter.max <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></span><span class="op">(</span>start <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">par</span>, objective <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">fn</span>, gradient <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">gr</span>,</span>
<span>              hessian <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">he</span>, lower <span class="op">=</span> <span class="va">Lwr</span>, upper <span class="op">=</span> <span class="va">Upr</span>, control <span class="op">=</span> <span class="va">control</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in nlminb(start = obj$par, objective = obj$fn, gradient = obj$gr, :</span></span>
<span><span class="co">#&gt; NA/NaN function evaluation</span></span>
<span><span class="co">#&gt; Warning in nlminb(start = obj$par, objective = obj$fn, gradient = obj$gr, :</span></span>
<span><span class="co">#&gt; NA/NaN function evaluation</span></span>
<span><span class="co">#&gt; Warning in nlminb(start = obj$par, objective = obj$fn, gradient = obj$gr, :</span></span>
<span><span class="co">#&gt; NA/NaN function evaluation</span></span>
<span><span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></span><span class="op">(</span>start <span class="op">=</span> <span class="va">opt</span><span class="op">$</span><span class="va">par</span>, objective <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">fn</span>, gradient <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">gr</span>,</span>
<span>              hessian <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">he</span>, lower <span class="op">=</span> <span class="va">Lwr</span>, upper <span class="op">=</span> <span class="va">Upr</span>, control <span class="op">=</span> <span class="va">control</span><span class="op">)</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">fn</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">gr</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">lp_prior</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">lp_penalty</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">lp_rec</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">lp_cpue</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">lp_lf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">lp_wf</span><span class="op">)</span></span></code></pre></div>
<p>Compare initial and estimated parameter values:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_par_table.html">get_par_table</a></span><span class="op">(</span><span class="va">obj</span>, <span class="va">parameters</span>, <span class="va">map</span>, lower <span class="op">=</span> <span class="va">Lwr</span>, upper <span class="op">=</span> <span class="va">Upr</span>, grad_tol <span class="op">=</span> <span class="fl">1e-2</span>, digits <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="co">#&gt; outer mgc:  4.072735e-12</span></span>
<span><span class="co">#&gt;          par init   est  lwr  upr       gr gr_chk bd_chk</span></span>
<span><span class="co">#&gt; 1     log_B0   20 14.00  0.0 22.0 -4.1e-12     OK     OK</span></span>
<span><span class="co">#&gt; 2 log_cpue_q    0 -0.02 -2.3  2.3 -2.3e-12     OK     OK</span></span></code></pre></div>
<div class="section level3">
<h3 id="diagnostics">Diagnostics<a class="anchor" aria-label="anchor" href="#diagnostics"></a>
</h3>
<p>Check that all parameters are estimable using the
<code>check_estimability</code> function:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_estimability.html">check_estimability</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">obj</span><span class="op">)</span></span>
<span><span class="co">#&gt; outer mgc:  4.072735e-12 </span></span>
<span><span class="co">#&gt; outer mgc:  7.301959 </span></span>
<span><span class="co">#&gt; outer mgc:  7.417775 </span></span>
<span><span class="co">#&gt; outer mgc:  7.425739 </span></span>
<span><span class="co">#&gt; outer mgc:  7.425739 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03705092 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03701259 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03777039 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03773221 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03855943 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03852048 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04029141 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04025065 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04058785 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0405457 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04280243 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04275888 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04312595 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04308214 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04344454 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0434004 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04228394 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04224013 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04352656 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04348221 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04347253 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04342828 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04371646 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04367193 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04074535 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0407036 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04109553 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04105475 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03835994 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03832198 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03608784 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03605214 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03193525 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03190177 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03167213 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0316406 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02989747 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02986787 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02850442 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02847622 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02533635 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02530866 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02648068 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02645423 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02645692 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02643076 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02673562 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02670921 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02531674 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02528939 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02713217 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02710517 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02757828 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02755108 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02797858 </span></span>
<span><span class="co">#&gt; outer mgc:  0.027951 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02763535 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02760712 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02861779 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02858954 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02907004 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02904146 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02974009 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02971088 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03029216 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03026184 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03149609 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03146479 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03272599 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03269393 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03335334 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03332072 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03287251 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03283961 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03248496 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03245265 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03205766 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03202629 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03148134 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03145055 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03102964 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03099895 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03116143 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03113071 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03166157 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03163062 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03253915 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03250738 </span></span>
<span><span class="co">#&gt; outer mgc:  0.033387 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03335367 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03490109 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03486654 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03591642 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03588142 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03592828 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03589328 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03531244 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03527759 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03465394 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03461984 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03363056 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03359775 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03253897 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03250723 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03138182 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03135066 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03059518 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03056492 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02984814 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02981896 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02925111 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02922252 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02893164 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02890287 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0294495 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02942037 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03039898 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03036926 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03146594 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03143522 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03138598 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03135417 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03095806 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03092699 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02945591 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02942706 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02728879 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02726206 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02505717 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02503155 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02413791 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02411345 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02418304 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02415924 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02470402 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0246794 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02598373 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02595717 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02844988 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02842121 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0309806 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03094995 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03263572 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03260341 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03329664 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03326311 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03274996 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03271711 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03064222 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03061179 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02796335 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02793564 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02544004 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02541439 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02367066 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02364684 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02248174 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02245933 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02191011 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02188835 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02213394 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02211179 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02310288 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02307987 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02443416 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02440989 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02617322 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02614725 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02782609 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02779825 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02938929 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02936007 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03028732 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03025733 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03047173 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03044151 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03004622 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03001622 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02916754 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02913847 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0281353 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0281073 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0276073 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02757975 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02782265 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02779461 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02868982 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02866097 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02929985 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02927042 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02884304 </span></span>
<span><span class="co">#&gt; outer mgc:  0.028814 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02642563 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02639812 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02449987 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0244748 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02287367 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02285052 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02184823 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02182604 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02103326 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02101124 </span></span>
<span><span class="co">#&gt; outer mgc:  0.020828 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02080656 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02015474 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02013409 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01918406 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01916441 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01724616 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01722754 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01613423 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01611744 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01507217 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01505673 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01431762 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01430289 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01372884 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01371407 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01405542 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01404072 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01454303 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01452784 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01530579 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01528968 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01606874 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01605145 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01686147 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01684333 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01710547 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01708688 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01700595 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01698723 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01647916 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01646061 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01565848 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01564079 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01462556 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01460893 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01370259 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01368679 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01283882 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01282361 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01236047 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01234579 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01190606 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01189174 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01141919 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01140522 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01082422 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01081057 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01058847 </span></span>
<span><span class="co">#&gt; outer mgc:  0.010575 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01043105 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01041747 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01014746 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01013383 </span></span>
<span><span class="co">#&gt; outer mgc:  0.009685618 </span></span>
<span><span class="co">#&gt; outer mgc:  0.009672127 </span></span>
<span><span class="co">#&gt; outer mgc:  0.009312784 </span></span>
<span><span class="co">#&gt; outer mgc:  0.009299263 </span></span>
<span><span class="co">#&gt; outer mgc:  0.008912726 </span></span>
<span><span class="co">#&gt; outer mgc:  0.008899084 </span></span>
<span><span class="co">#&gt; outer mgc:  0.008184648 </span></span>
<span><span class="co">#&gt; outer mgc:  0.008171483 </span></span>
<span><span class="co">#&gt; outer mgc:  0.007197504 </span></span>
<span><span class="co">#&gt; outer mgc:  0.007185436 </span></span>
<span><span class="co">#&gt; outer mgc:  0.006214566 </span></span>
<span><span class="co">#&gt; outer mgc:  0.00620384 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005658703 </span></span>
<span><span class="co">#&gt; outer mgc:  0.00565157 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005565039 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005558498 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005464202 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005458053 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005459641 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005453687 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005512257 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005506202 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005951965 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005948283 </span></span>
<span><span class="co">#&gt; outer mgc:  0.006568977 </span></span>
<span><span class="co">#&gt; outer mgc:  0.006564679 </span></span>
<span><span class="co">#&gt; outer mgc:  0.007521996 </span></span>
<span><span class="co">#&gt; outer mgc:  0.007517236 </span></span>
<span><span class="co">#&gt; outer mgc:  0.008950055 </span></span>
<span><span class="co">#&gt; outer mgc:  0.008944883 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01043485 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01042924 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01186668 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01186071 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01261979 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01261368 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01239226 </span></span>
<span><span class="co">#&gt; outer mgc:  0.012386 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01199413 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01198746 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01185217 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01184475 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01225857 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01225065 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01298552 </span></span>
<span><span class="co">#&gt; outer mgc:  0.012977 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01400607 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01399681 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01512083 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01511059 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0161317 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01612097 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01823648 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01823396 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01972271 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01971924 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02004934 </span></span>
<span><span class="co">#&gt; outer mgc:  0.020044 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02000971 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02000286 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0198004 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01979208 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01998454 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01997522 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02086931 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02085933 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0219632 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02195245 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02321409 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02320266 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02416807 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02415585 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02420947 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02419606 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02415429 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02414035 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02429449 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02428002 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02527904 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02526371 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02726969 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02725253 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03057398 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03055479 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03640508 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03638394 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04475474 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04473133 </span></span>
<span><span class="co">#&gt; outer mgc:  0.05563076 </span></span>
<span><span class="co">#&gt; outer mgc:  0.05560552 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06843682 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06841202 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07521148 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07518597 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07407738 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07404968 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0674127 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06738145 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06054421 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06051058 </span></span>
<span><span class="co">#&gt; outer mgc:  0.05713168 </span></span>
<span><span class="co">#&gt; outer mgc:  0.05709774 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0577185 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0576851 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0607472 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0607114 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06511649 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06507893 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07434123 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07430351 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08572162 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08568225 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09931663 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09927607 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1118563 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1118172 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1171744 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1171334 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1119395 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1118911 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1083053 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1082523 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1085015 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1084476 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1131364 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1130823 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1168027 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1167441 </span></span>
<span><span class="co">#&gt; outer mgc:  0.12824 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1281782 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1448289 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1447682 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1488663 </span></span>
<span><span class="co">#&gt; outer mgc:  0.148807 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1331433 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1330816 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1160581 </span></span>
<span><span class="co">#&gt; outer mgc:  0.115995 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1032122 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1031486 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09707163 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09700854 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1017144 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1016516 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1115651 </span></span>
<span><span class="co">#&gt; outer mgc:  0.111499 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1248447 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1247761 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1382938 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1382258 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1434027 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1433369 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1357267 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1356579 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1304035 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1303344 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1326064 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1325377 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1399934 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1399237 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1478892 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1478136 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1607946 </span></span>
<span><span class="co">#&gt; outer mgc:  0.160719 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1747331 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1746599 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1797385 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1796667 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1718467 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1717704 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1622535 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1621772 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1580853 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1580109 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1579289 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1578556 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1591844 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1591053 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1640026 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1639217 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1801885 </span></span>
<span><span class="co">#&gt; outer mgc:  0.180115 </span></span>
<span><span class="co">#&gt; outer mgc:  0.196168 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1961033 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1963476 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1962794 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1890751 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1890018 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1847872 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1847152 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1826456 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1825769 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1778515 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1777826 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1690758 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1690048 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1631956 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1631231 </span></span>
<span><span class="co">#&gt; outer mgc:  0.163937 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1638659 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1739192 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1738504 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1800206 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1799495 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1942705 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1942062 </span></span>
<span><span class="co">#&gt; outer mgc:  0.2003827 </span></span>
<span><span class="co">#&gt; outer mgc:  0.2003342 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1823035 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1822476 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1519063 </span></span>
<span><span class="co">#&gt; outer mgc:  0.151837 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1329732 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1329013 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1273073 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1272425 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1270056 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1269448 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1181345 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1180691 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1215816 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1215165 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1341553 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1340888 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1763906 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1763399 </span></span>
<span><span class="co">#&gt; outer mgc:  0.2123527 </span></span>
<span><span class="co">#&gt; outer mgc:  0.2123155 </span></span>
<span><span class="co">#&gt; outer mgc:  0.2587935 </span></span>
<span><span class="co">#&gt; outer mgc:  0.2588034 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1943547 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1943242 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1489883 </span></span>
<span><span class="co">#&gt; outer mgc:  0.148937 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1166996 </span></span>
<span><span class="co">#&gt; outer mgc:  0.116642 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1013811 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1013279 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09537271 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09532768 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09008129 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09003705 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08350529 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08346109 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08242265 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08238205 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08302936 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08299201 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08797039 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08794074 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08446968 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08443955 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08047273 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08044473 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07381704 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07379129 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06453203 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06450665 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04994719 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0499207 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03847386 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03845168 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02705258 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02703592 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01685738 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01684572 </span></span>
<span><span class="co">#&gt; outer mgc:  0.009547628 </span></span>
<span><span class="co">#&gt; outer mgc:  0.009540424 </span></span>
<span><span class="co">#&gt; outer mgc:  0.00457244 </span></span>
<span><span class="co">#&gt; outer mgc:  0.004568829 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002775735 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002775718 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002774406 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002774408 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002776984 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002776985 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002777671 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002777671 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002777778 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002777778</span></span></code></pre></div>
<p>Look for any parameters with high correlations (absolute correlation
&gt; 0.95) using the <code>get_cor_pairs</code> function:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_cor_pairs.html">get_cor_pairs</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">obj</span>, threshold <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "No pairs show strong positive or negative correlation relative to 0.95 threshold."</span></span></code></pre></div>
<p>Calculate standard deviations of all model parameters:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Report</span> <span class="op">&lt;-</span> <span class="fu">sdreport</span><span class="op">(</span><span class="va">obj</span><span class="op">)</span></span>
<span><span class="co">#&gt; outer mgc:  4.072735e-12 </span></span>
<span><span class="co">#&gt; outer mgc:  7.301959 </span></span>
<span><span class="co">#&gt; outer mgc:  7.417775 </span></span>
<span><span class="co">#&gt; outer mgc:  7.425739 </span></span>
<span><span class="co">#&gt; outer mgc:  7.425739 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03705092 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03701259 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03777039 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03773221 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03855943 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03852048 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04029141 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04025065 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04058785 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0405457 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04280243 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04275888 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04312595 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04308214 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04344454 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0434004 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04228394 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04224013 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04352656 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04348221 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04347253 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04342828 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04371646 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04367193 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04074535 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0407036 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04109553 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04105475 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03835994 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03832198 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03608784 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03605214 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03193525 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03190177 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03167213 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0316406 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02989747 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02986787 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02850442 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02847622 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02533635 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02530866 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02648068 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02645423 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02645692 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02643076 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02673562 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02670921 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02531674 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02528939 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02713217 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02710517 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02757828 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02755108 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02797858 </span></span>
<span><span class="co">#&gt; outer mgc:  0.027951 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02763535 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02760712 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02861779 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02858954 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02907004 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02904146 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02974009 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02971088 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03029216 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03026184 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03149609 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03146479 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03272599 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03269393 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03335334 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03332072 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03287251 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03283961 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03248496 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03245265 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03205766 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03202629 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03148134 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03145055 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03102964 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03099895 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03116143 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03113071 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03166157 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03163062 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03253915 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03250738 </span></span>
<span><span class="co">#&gt; outer mgc:  0.033387 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03335367 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03490109 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03486654 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03591642 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03588142 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03592828 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03589328 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03531244 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03527759 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03465394 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03461984 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03363056 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03359775 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03253897 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03250723 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03138182 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03135066 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03059518 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03056492 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02984814 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02981896 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02925111 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02922252 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02893164 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02890287 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0294495 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02942037 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03039898 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03036926 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03146594 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03143522 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03138598 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03135417 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03095806 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03092699 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02945591 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02942706 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02728879 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02726206 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02505717 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02503155 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02413791 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02411345 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02418304 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02415924 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02470402 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0246794 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02598373 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02595717 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02844988 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02842121 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0309806 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03094995 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03263572 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03260341 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03329664 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03326311 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03274996 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03271711 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03064222 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03061179 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02796335 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02793564 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02544004 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02541439 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02367066 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02364684 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02248174 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02245933 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02191011 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02188835 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02213394 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02211179 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02310288 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02307987 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02443416 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02440989 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02617322 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02614725 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02782609 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02779825 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02938929 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02936007 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03028732 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03025733 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03047173 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03044151 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03004622 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03001622 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02916754 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02913847 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0281353 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0281073 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0276073 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02757975 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02782265 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02779461 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02868982 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02866097 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02929985 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02927042 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02884304 </span></span>
<span><span class="co">#&gt; outer mgc:  0.028814 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02642563 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02639812 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02449987 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0244748 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02287367 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02285052 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02184823 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02182604 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02103326 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02101124 </span></span>
<span><span class="co">#&gt; outer mgc:  0.020828 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02080656 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02015474 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02013409 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01918406 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01916441 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01724616 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01722754 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01613423 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01611744 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01507217 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01505673 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01431762 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01430289 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01372884 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01371407 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01405542 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01404072 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01454303 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01452784 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01530579 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01528968 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01606874 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01605145 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01686147 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01684333 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01710547 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01708688 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01700595 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01698723 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01647916 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01646061 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01565848 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01564079 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01462556 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01460893 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01370259 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01368679 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01283882 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01282361 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01236047 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01234579 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01190606 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01189174 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01141919 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01140522 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01082422 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01081057 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01058847 </span></span>
<span><span class="co">#&gt; outer mgc:  0.010575 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01043105 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01041747 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01014746 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01013383 </span></span>
<span><span class="co">#&gt; outer mgc:  0.009685618 </span></span>
<span><span class="co">#&gt; outer mgc:  0.009672127 </span></span>
<span><span class="co">#&gt; outer mgc:  0.009312784 </span></span>
<span><span class="co">#&gt; outer mgc:  0.009299263 </span></span>
<span><span class="co">#&gt; outer mgc:  0.008912726 </span></span>
<span><span class="co">#&gt; outer mgc:  0.008899084 </span></span>
<span><span class="co">#&gt; outer mgc:  0.008184648 </span></span>
<span><span class="co">#&gt; outer mgc:  0.008171483 </span></span>
<span><span class="co">#&gt; outer mgc:  0.007197504 </span></span>
<span><span class="co">#&gt; outer mgc:  0.007185436 </span></span>
<span><span class="co">#&gt; outer mgc:  0.006214566 </span></span>
<span><span class="co">#&gt; outer mgc:  0.00620384 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005658703 </span></span>
<span><span class="co">#&gt; outer mgc:  0.00565157 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005565039 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005558498 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005464202 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005458053 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005459641 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005453687 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005512257 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005506202 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005951965 </span></span>
<span><span class="co">#&gt; outer mgc:  0.005948283 </span></span>
<span><span class="co">#&gt; outer mgc:  0.006568977 </span></span>
<span><span class="co">#&gt; outer mgc:  0.006564679 </span></span>
<span><span class="co">#&gt; outer mgc:  0.007521996 </span></span>
<span><span class="co">#&gt; outer mgc:  0.007517236 </span></span>
<span><span class="co">#&gt; outer mgc:  0.008950055 </span></span>
<span><span class="co">#&gt; outer mgc:  0.008944883 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01043485 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01042924 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01186668 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01186071 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01261979 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01261368 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01239226 </span></span>
<span><span class="co">#&gt; outer mgc:  0.012386 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01199413 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01198746 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01185217 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01184475 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01225857 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01225065 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01298552 </span></span>
<span><span class="co">#&gt; outer mgc:  0.012977 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01400607 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01399681 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01512083 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01511059 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0161317 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01612097 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01823648 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01823396 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01972271 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01971924 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02004934 </span></span>
<span><span class="co">#&gt; outer mgc:  0.020044 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02000971 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02000286 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0198004 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01979208 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01998454 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01997522 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02086931 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02085933 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0219632 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02195245 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02321409 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02320266 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02416807 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02415585 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02420947 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02419606 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02415429 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02414035 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02429449 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02428002 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02527904 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02526371 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02726969 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02725253 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03057398 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03055479 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03640508 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03638394 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04475474 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04473133 </span></span>
<span><span class="co">#&gt; outer mgc:  0.05563076 </span></span>
<span><span class="co">#&gt; outer mgc:  0.05560552 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06843682 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06841202 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07521148 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07518597 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07407738 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07404968 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0674127 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06738145 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06054421 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06051058 </span></span>
<span><span class="co">#&gt; outer mgc:  0.05713168 </span></span>
<span><span class="co">#&gt; outer mgc:  0.05709774 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0577185 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0576851 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0607472 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0607114 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06511649 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06507893 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07434123 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07430351 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08572162 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08568225 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09931663 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09927607 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1118563 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1118172 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1171744 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1171334 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1119395 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1118911 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1083053 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1082523 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1085015 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1084476 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1131364 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1130823 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1168027 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1167441 </span></span>
<span><span class="co">#&gt; outer mgc:  0.12824 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1281782 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1448289 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1447682 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1488663 </span></span>
<span><span class="co">#&gt; outer mgc:  0.148807 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1331433 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1330816 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1160581 </span></span>
<span><span class="co">#&gt; outer mgc:  0.115995 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1032122 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1031486 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09707163 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09700854 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1017144 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1016516 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1115651 </span></span>
<span><span class="co">#&gt; outer mgc:  0.111499 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1248447 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1247761 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1382938 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1382258 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1434027 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1433369 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1357267 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1356579 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1304035 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1303344 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1326064 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1325377 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1399934 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1399237 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1478892 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1478136 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1607946 </span></span>
<span><span class="co">#&gt; outer mgc:  0.160719 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1747331 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1746599 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1797385 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1796667 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1718467 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1717704 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1622535 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1621772 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1580853 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1580109 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1579289 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1578556 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1591844 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1591053 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1640026 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1639217 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1801885 </span></span>
<span><span class="co">#&gt; outer mgc:  0.180115 </span></span>
<span><span class="co">#&gt; outer mgc:  0.196168 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1961033 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1963476 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1962794 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1890751 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1890018 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1847872 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1847152 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1826456 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1825769 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1778515 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1777826 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1690758 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1690048 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1631956 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1631231 </span></span>
<span><span class="co">#&gt; outer mgc:  0.163937 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1638659 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1739192 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1738504 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1800206 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1799495 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1942705 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1942062 </span></span>
<span><span class="co">#&gt; outer mgc:  0.2003827 </span></span>
<span><span class="co">#&gt; outer mgc:  0.2003342 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1823035 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1822476 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1519063 </span></span>
<span><span class="co">#&gt; outer mgc:  0.151837 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1329732 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1329013 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1273073 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1272425 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1270056 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1269448 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1181345 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1180691 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1215816 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1215165 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1341553 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1340888 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1763906 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1763399 </span></span>
<span><span class="co">#&gt; outer mgc:  0.2123527 </span></span>
<span><span class="co">#&gt; outer mgc:  0.2123155 </span></span>
<span><span class="co">#&gt; outer mgc:  0.2587935 </span></span>
<span><span class="co">#&gt; outer mgc:  0.2588034 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1943547 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1943242 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1489883 </span></span>
<span><span class="co">#&gt; outer mgc:  0.148937 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1166996 </span></span>
<span><span class="co">#&gt; outer mgc:  0.116642 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1013811 </span></span>
<span><span class="co">#&gt; outer mgc:  0.1013279 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09537271 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09532768 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09008129 </span></span>
<span><span class="co">#&gt; outer mgc:  0.09003705 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08350529 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08346109 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08242265 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08238205 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08302936 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08299201 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08797039 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08794074 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08446968 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08443955 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08047273 </span></span>
<span><span class="co">#&gt; outer mgc:  0.08044473 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07381704 </span></span>
<span><span class="co">#&gt; outer mgc:  0.07379129 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06453203 </span></span>
<span><span class="co">#&gt; outer mgc:  0.06450665 </span></span>
<span><span class="co">#&gt; outer mgc:  0.04994719 </span></span>
<span><span class="co">#&gt; outer mgc:  0.0499207 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03847386 </span></span>
<span><span class="co">#&gt; outer mgc:  0.03845168 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02705258 </span></span>
<span><span class="co">#&gt; outer mgc:  0.02703592 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01685738 </span></span>
<span><span class="co">#&gt; outer mgc:  0.01684572 </span></span>
<span><span class="co">#&gt; outer mgc:  0.009547628 </span></span>
<span><span class="co">#&gt; outer mgc:  0.009540424 </span></span>
<span><span class="co">#&gt; outer mgc:  0.00457244 </span></span>
<span><span class="co">#&gt; outer mgc:  0.004568829 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002775735 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002775718 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002774406 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002774408 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002776984 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002776985 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002777671 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002777671 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002777778 </span></span>
<span><span class="co">#&gt; outer mgc:  0.002777778</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-fits">Data fits<a class="anchor" aria-label="anchor" href="#data-fits"></a>
</h3>
<p>Inspect predicted vs observed length compositions:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">lf_switch</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Length composition likelihood is switched off (lf_switch = 0), so no predicted length compositions to show.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">lf_rep</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">lf_pred</span> <span class="op">&lt;-</span> <span class="va">lf_rep</span><span class="op">$</span><span class="va">lf_pred</span></span>
<span>  <span class="va">nbins</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">lf_maxbin</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">data</span><span class="op">$</span><span class="va">lf_minbin</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span>  <span class="co"># Name the list elements and columns</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lf_pred</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">lf_fishery_f</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">lf_pred</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">lf_pred</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">len_mid</span></span>
<span></span>
<span>  <span class="co"># Helper: convert a flat OBS vector back to list-of-matrices (proportions)</span></span>
<span>  <span class="va">flat_to_list</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">v</span>, <span class="va">lf_n_f</span>, <span class="va">nbins</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lf_n_f</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">offset</span> <span class="op">&lt;-</span> <span class="fl">0L</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">lf_n_f</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">v</span><span class="op">[</span><span class="op">(</span><span class="va">offset</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">offset</span> <span class="op">+</span> <span class="va">lf_n_f</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">*</span> <span class="va">nbins</span><span class="op">)</span><span class="op">]</span>, nrow <span class="op">=</span> <span class="va">lf_n_f</span><span class="op">[</span><span class="va">k</span><span class="op">]</span>, ncol <span class="op">=</span> <span class="va">nbins</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      <span class="co"># Normalise each row to proportions</span></span>
<span>      <span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span>      <span class="va">rs</span><span class="op">[</span><span class="va">rs</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="va">out</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">/</span> <span class="va">rs</span></span>
<span>      <span class="va">offset</span> <span class="op">&lt;-</span> <span class="va">offset</span> <span class="op">+</span> <span class="va">lf_n_f</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">*</span> <span class="va">nbins</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">out</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Split year index by fishery (must match length of lf_year)</span></span>
<span>  <span class="va">lf_year_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">lf_year</span>, <span class="va">data</span><span class="op">$</span><span class="va">lf_fishery</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ---- Predicted: long data frame ----</span></span>
<span>  <span class="va">df_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">lf_pred</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">lf_pred</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">yrs</span> <span class="op">&lt;-</span> <span class="va">lf_year_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">as.data.frame.table</a></span><span class="op">(</span><span class="va">m</span>, responseName <span class="op">=</span> <span class="st">"pred"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">Var1</span>, length <span class="op">=</span> <span class="va">Var2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fishery <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lf_pred</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>            id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">id</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            year <span class="op">=</span> <span class="va">yrs</span><span class="op">[</span><span class="va">id</span><span class="op">]</span>,</span>
<span>            length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ---- Observed: long data frame ----</span></span>
<span>  <span class="va">df_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">lf_obs_in</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_obs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">len_mid</span></span>
<span>  <span class="va">df_obs</span> <span class="op">&lt;-</span> <span class="va">df_obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">lf_year</span>, fishery <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">lf_fishery</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">fishery</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">fishery</span>, <span class="va">id</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"length"</span>, values_to <span class="op">=</span> <span class="st">"obs"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ---- Simulations: generate n_sim draws and convert to long format ----</span></span>
<span>  <span class="va">n_sim</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span>  <span class="va">df_sim_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_sim</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Determine which OBS vector was active based on lf_switch</span></span>
<span>    <span class="va">sim</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">lf_switch</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">sim_vec</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="va">lf_obs_flat</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">lf_switch</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">sim_vec</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="va">lf_obs_prop</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">sim_vec</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="va">lf_obs_ints</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">sim_list</span> <span class="op">&lt;-</span> <span class="fu">flat_to_list</span><span class="op">(</span><span class="va">sim_vec</span>, <span class="va">data</span><span class="op">$</span><span class="va">lf_n_f</span>, <span class="va">nbins</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">lf_fishery_f</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">len_mid</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">sim_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="va">yrs</span> <span class="op">&lt;-</span> <span class="va">lf_year_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">as.data.frame.table</a></span><span class="op">(</span><span class="va">m</span>, responseName <span class="op">=</span> <span class="st">"sim"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">Var1</span>, length <span class="op">=</span> <span class="va">Var2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fishery <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>              id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">id</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              year <span class="op">=</span> <span class="va">yrs</span><span class="op">[</span><span class="va">id</span><span class="op">]</span>,</span>
<span>              length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span>,</span>
<span>              sim_id <span class="op">=</span> <span class="va">s</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ---- Join observed + predicted ----</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_obs</span>, <span class="va">df_pred</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"fishery"</span>, <span class="st">"length"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">year.y</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">year.x</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ---- Plot fishery 8 ----</span></span>
<span>  <span class="va">yrs_plot</span> <span class="op">&lt;-</span> <span class="fl">146</span><span class="op">:</span><span class="fl">188</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fishery</span> <span class="op">==</span> <span class="st">"8"</span>, <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">yrs_plot</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">obs</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey70"</span>, width <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_sim_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fishery</span> <span class="op">==</span> <span class="st">"8"</span>, <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">yrs_plot</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">sim</span>, group <span class="op">=</span> <span class="va">sim_id</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"steelblue"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, linewidth <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">pred</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"red3"</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">year</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, ncol <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Length (cm)"</span>, y <span class="op">=</span> <span class="st">"Proportion"</span>,</span>
<span>        title <span class="op">=</span> <span class="st">"Length composition: Fishery 8"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"Grey bars = observed, red = predicted, blue = simulated"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>          axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ---- Plot fishery 9 ----</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fishery</span> <span class="op">==</span> <span class="st">"9"</span>, <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">yrs_plot</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">obs</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey70"</span>, width <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_sim_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fishery</span> <span class="op">==</span> <span class="st">"9"</span>, <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">yrs_plot</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">sim</span>, group <span class="op">=</span> <span class="va">sim_id</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"steelblue"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, linewidth <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">pred</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"red3"</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">year</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, ncol <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Length (cm)"</span>, y <span class="op">=</span> <span class="st">"Proportion"</span>,</span>
<span>        title <span class="op">=</span> <span class="st">"Length composition: Fishery 9"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"Grey bars = observed, red = predicted, blue = simulated"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>          axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Length composition likelihood is switched off (lf_switch = 0), so no predicted length compositions to show.</span></span></code></pre></div>
<p>Inspect predicted vs observed weight compositions:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">wf_switch</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Weight composition likelihood is switched off (wf_switch = 0), so no predicted weight compositions to show.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">wf_rep</span>  <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">wf_pred</span> <span class="op">&lt;-</span> <span class="va">wf_rep</span><span class="op">$</span><span class="va">wf_pred</span></span>
<span>  <span class="va">wt_mid_trim</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">wt_mid</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">wf_minbin</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">wf_fishery_f</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">:</span></span>
<span>                              <span class="va">data</span><span class="op">$</span><span class="va">wf_maxbin</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">wf_fishery_f</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">wf_pred</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">wf_fishery_f</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">wf_pred</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">wf_pred</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">wt_mid_trim</span></span>
<span></span>
<span>  <span class="va">wf_year_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">wf_year</span>, <span class="va">data</span><span class="op">$</span><span class="va">wf_fishery</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ---- Predicted: long data frame ----</span></span>
<span>  <span class="va">df_wf_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">wf_pred</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">m</span>   <span class="op">&lt;-</span> <span class="va">wf_pred</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">yrs</span> <span class="op">&lt;-</span> <span class="va">wf_year_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">as.data.frame.table</a></span><span class="op">(</span><span class="va">m</span>, responseName <span class="op">=</span> <span class="st">"pred"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">Var1</span>, weight <span class="op">=</span> <span class="va">Var2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fishery <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">wf_pred</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>            id      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">id</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            year    <span class="op">=</span> <span class="va">yrs</span><span class="op">[</span><span class="va">id</span><span class="op">]</span>,</span>
<span>            weight  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ---- Observed: long data frame (first WF fishery only for this plot) ----</span></span>
<span>  <span class="va">df_wf_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">wf_obs_in</span><span class="op">[</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">wf_n_f</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_wf_obs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">wt_mid</span></span>
<span>  <span class="va">df_wf_obs</span> <span class="op">&lt;-</span> <span class="va">df_wf_obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year    <span class="op">=</span> <span class="va">wf_year_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>          fishery <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">wf_fishery_f</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">fishery</span>, <span class="va">id</span><span class="op">)</span>,</span>
<span>                names_to <span class="op">=</span> <span class="st">"weight"</span>, values_to <span class="op">=</span> <span class="st">"obs"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">&gt;=</span> <span class="va">wt_mid_trim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">weight</span> <span class="op">&lt;=</span> <span class="va">wt_mid_trim</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">wt_mid_trim</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">df_wf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_wf_obs</span>, <span class="va">df_wf_pred</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"fishery"</span>, <span class="st">"weight"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ---- Plot first fishery with WF data ----</span></span>
<span>  <span class="va">f_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">wf_fishery_f</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">max_yrs_wf_plot</span> <span class="op">&lt;-</span> <span class="fl">24</span>  <span class="co"># show at most 24 time steps for readability</span></span>
<span>  <span class="va">yrs_wf_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df_wf</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">max_yrs_wf_plot</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df_wf</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_wf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fishery</span> <span class="op">==</span> <span class="va">f_plot</span>, <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">yrs_wf_plot</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">obs</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey70"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">pred</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"red3"</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">year</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, ncol <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Weight (kg)"</span>, y <span class="op">=</span> <span class="st">"Proportion"</span>,</span>
<span>        title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Weight composition: Fishery "</span>, <span class="va">f_plot</span><span class="op">)</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"Grey bars = observed, red = predicted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>          axis.text  <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Weight composition likelihood is switched off (wf_switch = 0), so no predicted weight compositions to show.</span></span></code></pre></div>
<p>Inspect fitted CPUE and catch:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">cpue_switch</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"CPUE likelihood is switched off (cpue_switch = 0), so no predicted CPUE to show.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">cpue_data</span><span class="op">$</span><span class="va">value</span>, col <span class="op">=</span> <span class="fl">2</span>, pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>      xlab <span class="op">=</span> <span class="st">"Time step"</span>, ylab <span class="op">=</span> <span class="st">"CPUE"</span>, main <span class="op">=</span> <span class="st">"CPUE: observed vs predicted"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">cpue_log_obs</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"gray70"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">cpue_pred</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="bet_files/figure-html/opt-cpue-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">catch_pred_ysf</span> <span class="op">-</span> <span class="va">data</span><span class="op">$</span><span class="va">catch_obs_ysf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9998705</span></span>
<span><span class="fu"><a href="../reference/plot_catch.html">plot_catch</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, obj <span class="op">=</span> <span class="va">obj</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The maximum catch difference was: 2.20916081161704e-06"</span></span></code></pre></div>
<p><img src="bet_files/figure-html/opt-catch-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_catch.html">plot_catch</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, obj <span class="op">=</span> <span class="va">obj</span>, plot_resid <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The maximum catch difference was: 2.20916081161704e-06"</span></span></code></pre></div>
<p><img src="bet_files/figure-html/opt-catch-2.png" class="r-plt" alt="" width="672"></p>
<p>Inspect estimated spawning biomass trajectory:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">spawning_biomass_y</span>, type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time step"</span>, ylab <span class="op">=</span> <span class="st">"Spawning biomass (mt)"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Estimated spawning biomass trajectory"</span>,</span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">spawning_biomass_y</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="bet_files/figure-html/opt-spbio-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="selectivity">Selectivity<a class="anchor" aria-label="anchor" href="#selectivity"></a>
</h3>
<p>Visualise the selectivity curves by fleet (at length):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par_sel_est</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="va">env</span><span class="op">$</span><span class="fu">parList</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">par_sel</span></span>
<span></span>
<span><span class="va">fleet_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F01_LL.NORTH"</span>, <span class="st">"F02_LL.US"</span>, <span class="st">"F03_LL.OFFSH"</span>,</span>
<span>                 <span class="st">"F04_LL.EQUAT"</span>, <span class="st">"F05_LL.WEST"</span>, <span class="st">"F06_LL.SOUTH"</span>, <span class="st">"F07_LL.AUS"</span>,</span>
<span>                 <span class="st">"F08_PS.ASSOC"</span>, <span class="st">"F09_PS.UNASS"</span>, <span class="st">"F10_DOM.MISC"</span>,</span>
<span>                 <span class="st">"F11_DOM.HL"</span>, <span class="st">"F12_JP.PS.N"</span>, <span class="st">"F13_JP.PL"</span>, <span class="st">"F14_EQ.PL"</span>,</span>
<span>                 <span class="st">"S01_INDEX"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sel_len_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">n_fishery</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">par_f</span> <span class="op">&lt;-</span> <span class="va">par_sel_est</span><span class="op">[</span><span class="va">f</span>, <span class="op">]</span></span>
<span>  <span class="va">sel_l</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">sel_type_f</span><span class="op">[</span><span class="va">f</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1L</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/sel_logistic.html">sel_logistic</a></span><span class="op">(</span><span class="va">len_mid</span>, <span class="va">par_f</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/sel_double_normal.html">sel_double_normal</a></span><span class="op">(</span><span class="va">len_mid</span>, <span class="va">par_f</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    fishery    <span class="op">=</span> <span class="va">f</span>,</span>
<span>    fleet_name <span class="op">=</span> <span class="va">fleet_names</span><span class="op">[</span><span class="va">f</span><span class="op">]</span>,</span>
<span>    length     <span class="op">=</span> <span class="va">len_mid</span>,</span>
<span>    selectivity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sel_l</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sel_len_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span>, y <span class="op">=</span> <span class="va">selectivity</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">fleet_name</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Length (cm)"</span>, y <span class="op">=</span> <span class="st">"Selectivity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="bet_files/figure-html/plot-selectivity-length-1.png" class="r-plt" alt="Selectivity-at-Length by Fleet" width="960"><p class="caption">
Selectivity-at-Length by Fleet
</p>
</div>
<p>Visualise the selectivity curves by fleet (at age):</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rep</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">sel_fya</span> <span class="op">&lt;-</span> <span class="va">rep</span><span class="op">$</span><span class="va">sel_fya</span></span>
<span></span>
<span><span class="va">sel_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>fishery <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">data</span><span class="op">$</span><span class="va">n_fishery</span>, age <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">data</span><span class="op">$</span><span class="va">n_age</span><span class="op">)</span></span>
<span><span class="va">sel_df</span><span class="op">$</span><span class="va">selectivity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sel_df</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sel_fya</span><span class="op">[</span><span class="va">sel_df</span><span class="op">$</span><span class="va">fishery</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">sel_df</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">sel_df</span><span class="op">$</span><span class="va">real_age</span> <span class="op">&lt;-</span> <span class="va">sel_df</span><span class="op">$</span><span class="va">age</span> <span class="op">/</span> <span class="fl">4</span></span>
<span><span class="va">sel_df</span><span class="op">$</span><span class="va">fleet_name</span> <span class="op">&lt;-</span> <span class="va">fleet_names</span><span class="op">[</span><span class="va">sel_df</span><span class="op">$</span><span class="va">fishery</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sel_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">real_age</span>, y <span class="op">=</span> <span class="va">selectivity</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">fleet_name</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age (years)"</span>, y <span class="op">=</span> <span class="st">"Selectivity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="bet_files/figure-html/plot-selectivity-1.png" class="r-plt" alt="Selectivity-at-Age by Fleet" width="960"><p class="caption">
Selectivity-at-Age by Fleet
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h2>
<p>The CPUE series is set up using RTMB’s <code>OBS</code> mechanism
inside the model, which allows simulation via
<code>obj$simulate()</code>. For example:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">cpue_switch</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"CPUE likelihood is switched off (cpue_switch = 0), so no simulated CPUE to show.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">cpue_data</span><span class="op">$</span><span class="va">value</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">2</span>, pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>      xlab <span class="op">=</span> <span class="st">"Time step"</span>, ylab <span class="op">=</span> <span class="st">"log(CPUE)"</span>, main <span class="op">=</span> <span class="st">"Observed vs simulated CPUE"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">cpue_pred</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">cpue_log_obs</span>, col <span class="op">=</span> <span class="st">"gray70"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="bet_files/figure-html/sim-1-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level2">
<h2 id="one-step-ahead-osa-residuals">One step ahead (OSA) residuals<a class="anchor" aria-label="anchor" href="#one-step-ahead-osa-residuals"></a>
</h2>
<p>OSA residuals are a replacement for Pearson residuals:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">cpue_switch</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"CPUE likelihood is switched off (cpue_switch = 0), so no OSA residuals to show.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">osa_cpue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RTMB/man/OSA-residuals.html" class="external-link">oneStepPredict</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">obj</span>, observation.name <span class="op">=</span> <span class="st">"cpue_log_obs"</span>,</span>
<span>                            method <span class="op">=</span> <span class="st">"oneStepGeneric"</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqnorm</a></span><span class="op">(</span><span class="va">osa_cpue</span><span class="op">$</span><span class="va">res</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">osa_cpue</span><span class="op">$</span><span class="va">res</span>, xlab <span class="op">=</span> <span class="st">"Index"</span>, ylab <span class="op">=</span> <span class="st">"OSA residual"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="bet_files/figure-html/osa1-1.png" class="r-plt" alt="" width="672"><img src="bet_files/figure-html/osa1-2.png" class="r-plt" alt="" width="672"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Darcy Webber, Philipp Neubauer, Nicholas Ducharme-Barth.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
